import{r as c,j as e}from"./app-Aw6YSH6g.js";import{B as F}from"./badge-CIMVAU4m.js";import{B as x}from"./createLucideIcon-D6F2HjNJ.js";import{C as $,a as z,b as I,d as M,c as O}from"./card-Bb0v4BpC.js";import{I as R}from"./input-DDWDjiWn.js";import{L as N}from"./loader-circle-BJ7mB44w.js";import{S as q}from"./search-BejOA3Ep.js";import{C as J}from"./chevron-left-ChJWCWLM.js";import{C as K}from"./chevron-right-DlF4IjTy.js";import{M as U}from"./map-pin-NmMPXV0O.js";function se({initialSearch:f="",mapBounds:n,onLocationClick:g}){const[t,_]=c.useState(null),[o,b]=c.useState(!1),[i,v]=c.useState(f),[l,m]=c.useState(1),[h,k]=c.useState(15),[L,P]=c.useState(""),A=(s,r)=>{let a;return(...u)=>{clearTimeout(a),a=setTimeout(()=>s(...u),r)}},d=c.useCallback(async(s=1,r="",a=null,u=!1)=>{var S;const y=JSON.stringify({page:s,searchTerm:r,bounds:a,perPage:h});if(!(!u&&y===L)){b(!0);try{const p=await fetch("/admin/cancel-subscription/table-data",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((S=document.querySelector('meta[name="csrf-token"]'))==null?void 0:S.getAttribute("content"))||""},body:JSON.stringify({page:s,per_page:h,search:r,bounds:a})});if(p.ok){const E=await p.json();_(E),P(y)}}catch(p){console.error("Error fetching table data:",p)}finally{b(!1)}}},[h]),C=c.useCallback(A((s,r,a)=>{d(s,r,a,!0)},300),[d]);c.useEffect(()=>{d(1,i,n,!0),m(1)},[n,h]),c.useEffect(()=>{i!==f&&(C(1,i,n),m(1))},[i,n,C,f]);const D=s=>{s.preventDefault(),d(1,i,n,!0),m(1)},j=s=>{s>=1&&s<=((t==null?void 0:t.last_page)||1)&&s!==l&&(m(s),d(s,i,n,!0))},T=s=>{s.lat&&s.lng&&g&&g(s.lat,s.lng,s)},w=[{header:"Customer",className:"min-w-[180px]",render:s=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.customer_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.customer_id})]})},{header:"Contact",className:"min-w-[160px]",render:s=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:s.customer_phone}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.customer_email||"N/A"})]})},{header:"Subscription",className:"min-w-[140px]",render:s=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.subscription_id}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Service: ",s.serv_id]})]})},{header:"Description",className:"min-w-[200px]",render:s=>e.jsx("div",{className:"max-w-[200px]",children:e.jsx("p",{className:"truncate text-sm",title:s.subscription_description,children:s.subscription_description||"N/A"})})},{header:"Status",className:"min-w-[100px]",render:s=>e.jsx(F,{variant:"destructive",children:s.subscription_status})},{header:"Location",className:"min-w-[200px]",render:s=>e.jsxs("div",{children:[e.jsx("p",{className:"font-mono text-sm",children:s.coordinates}),e.jsx("p",{className:"max-w-[180px] truncate text-xs text-muted-foreground",title:s.subscription_address,children:s.subscription_address||"N/A"})]})},{header:"Updated At",className:"min-w-[160px]",render:s=>e.jsx("div",{children:e.jsxs("p",{className:"text-sm",children:["Updated At: ",s.updated_at]})})},{header:"Actions",className:"min-w-[140px]",render:s=>e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>T(s),disabled:!s.lat||!s.lng,children:[e.jsx(U,{className:"mr-1 h-4 w-4"}),s.lat&&s.lng?"View on Map":"No Location"]})}];return e.jsxs($,{children:[e.jsxs(z,{children:[e.jsxs(I,{className:"flex items-center gap-2",children:["Canceled Subscriptions Data",o&&e.jsx(N,{className:"h-4 w-4 animate-spin"})]}),e.jsxs(M,{children:["Detailed view of canceled subscriptions",n&&" (filtered by map view)",t&&` - Showing ${t.from}-${t.to} of ${t.total} records`]})]}),e.jsxs(O,{children:[e.jsxs("form",{onSubmit:D,className:"mb-4 flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(R,{placeholder:"Search by customer name, ID, subscription, service, description...",value:i,onChange:s=>v(s.target.value)})}),e.jsxs(x,{type:"submit",disabled:o,children:[o?e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(q,{className:"mr-2 h-4 w-4"}),"Search"]}),i&&e.jsx(x,{type:"button",variant:"outline",onClick:()=>{v(""),d(1,"",n),m(1)},children:"Clear"})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Show"}),e.jsxs("select",{value:h,onChange:s=>{const r=Number(s.target.value);k(r),m(1),d(1,i,n,!0)},className:"rounded border px-2 py-1 text-sm dark:bg-muted dark:text-muted-foreground",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:15,children:"15"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]}),e.jsx("span",{className:"text-sm",children:"entries"})]}),e.jsx("div",{className:"space-y-4",children:t?t.data.length===0?e.jsx("div",{className:"py-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:i||n?"No canceled subscriptions found matching your criteria.":"No canceled subscriptions found."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"rounded-md",children:e.jsxs("table",{className:"w-full min-w-[1200px] border-collapse",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsx("tr",{children:w.map((s,r)=>e.jsx("th",{className:`border-b px-4 py-3 text-left text-sm font-medium ${s.className||""}`,children:s.header},r))})}),e.jsx("tbody",{children:t.data.map((s,r)=>e.jsx("tr",{className:"border-b hover:bg-muted/50",children:w.map((a,u)=>e.jsx("td",{className:`px-4 py-3 text-sm ${a.className||""}`,children:a.render(s)},u))},s.id))})]})})}),t.last_page>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",t.from," to ",t.to," of ",t.total," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>j(l-1),disabled:l<=1||o,children:[e.jsx(J,{className:"h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,t.last_page)},(s,r)=>{let a;return t.last_page<=5||l<=3?a=r+1:l>=t.last_page-2?a=t.last_page-4+r:a=l-2+r,e.jsx(x,{variant:l===a?"default":"outline",size:"sm",onClick:()=>j(a),disabled:o,className:"h-8 w-8 p-0",children:a},a)})}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>j(l+1),disabled:l>=t.last_page||o,children:["Next",e.jsx(K,{className:"h-4 w-4"})]})]})]})]}):e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(N,{className:"mx-auto mb-4 h-8 w-8 animate-spin"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading data..."})]})})]})]})}export{se as default};
