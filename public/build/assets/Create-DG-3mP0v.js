import{r as c,j as e,x as Q,Q as V,t as D}from"./app-Dut1LdAE.js";import{B as j,c as y}from"./createLucideIcon-C0iULVoC.js";import{C as F,a as T,b as P,c as A}from"./card-Dx9aJHDz.js";import{C as $}from"./chevron-down-CE-Fbol3.js";import{S as K}from"./search-C2u3JxhX.js";import{C as M}from"./index-DiuZmm2K.js";import{I as G}from"./input-D3vML1ww.js";import{L as h}from"./label-BRVQcqGu.js";import{S as L,a as R,b as U,c as E,d as f}from"./select-BkxJJpQf.js";import{T as I}from"./textarea-CJxFNjdI.js";import{A as J}from"./app-layout-Ba11ixHv.js";import{A as W}from"./arrow-left-TsPNlG17.js";import{S as X}from"./save-UYcBIVIf.js";import"./index-4ihCrLj8.js";import"./index-CRfXtssg.js";import"./index-DOUln0NY.js";import"./index-CTJ23LsC.js";import"./index-CApfq8oQ.js";import"./breadcrumbs-CcrN4L9y.js";import"./app-logo-CqiyE-ly.js";import"./index-C1Ioh-Wa.js";import"./index-BgiYP7hp.js";import"./index-hxn349B7.js";import"./chevron-right-CUpFF3n3.js";import"./file-text-Bo_ZNioe.js";import"./target-Cupp5148.js";function Y({value:m,onValueChange:i,onSubscriptionChange:o,disabled:n=!1,placeholder:v="Select customer..."}){var S;const[u,r]=c.useState(!1),[l,N]=c.useState(""),[d,p]=c.useState([]),[t,_]=c.useState(!1),[x,B]=c.useState(null),[z,b]=c.useState(!1),g=c.useRef(null),q=async s=>{if(s.length<3){p([]);return}_(!0);try{console.log("Searching for:",s);const a=new URL(route("admin.follow-ups.search-customers"));a.searchParams.append("search",s),console.log("Request URL:",a.toString());const C=await fetch(a.toString());console.log("Response status:",C.status);const k=await C.json();console.log("Response data:",k),p(k)}catch(a){console.error("Error searching customers:",a),p([])}finally{_(!1)}};c.useEffect(()=>(g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{q(l)},300),()=>{g.current&&clearTimeout(g.current)}),[l]),c.useEffect(()=>{console.log("Customers data:",d),console.log("Search term:",l),console.log("Loading:",t)},[d,l,t]);const H=s=>{B(s),s.subscriptions&&s.subscriptions.length>1?b(!0):s.subscriptions&&s.subscriptions.length===1?(i(s.customer_id),o==null||o(s.subscriptions[0].subscription_id),r(!1)):(i(s.customer_id),o==null||o(""),r(!1))},w=s=>{x&&(i(x.customer_id),o==null||o(s),r(!1),b(!1))},O=()=>{if(!m)return v;const s=d.find(a=>a.customer_id===m);return s?`${s.customer_name} (${s.customer_id})`:m};return e.jsxs("div",{className:"relative w-full",onClick:s=>s.stopPropagation(),onSubmit:s=>s.preventDefault(),children:[e.jsxs(j,{type:"button",variant:"outline",role:"combobox","aria-expanded":u,className:"w-full justify-between",disabled:n,onClick:s=>{s.preventDefault(),s.stopPropagation(),r(!u)},children:[e.jsx("span",{className:"truncate",children:O()}),e.jsx($,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]}),u&&e.jsx("div",{className:"absolute top-full left-0 z-50 w-full mt-1 bg-card border border-border rounded-md shadow-lg",children:z?e.jsxs("div",{className:"space-y-2 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-foreground",children:"Select Subscription"}),e.jsx(j,{variant:"ghost",size:"sm",onClick:s=>{s.preventDefault(),s.stopPropagation(),b(!1)},children:"Back"})]}),x&&e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Customer: ",x.customer_name]}),e.jsxs("div",{className:"max-h-[200px] overflow-y-auto space-y-1",children:[e.jsx("div",{className:"flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",onClick:s=>{s.preventDefault(),s.stopPropagation(),w("")},children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-foreground",children:"No Subscription"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Create follow-up without specific subscription"})]})}),(S=x==null?void 0:x.subscriptions)==null?void 0:S.map(s=>e.jsx("div",{className:"flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",onClick:a=>{a.preventDefault(),a.stopPropagation(),w(s.subscription_id)},children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-foreground",children:s.subscription_id}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.subscription_description}),e.jsx("div",{className:y("text-xs px-1.5 py-0.5 rounded-full inline-block mt-1",s.subscription_status==="active"?"bg-success text-green-800 dark:bg-success dark:text-green-400":"bg-muted text-muted-foreground"),children:s.subscription_status})]})},s.subscription_id))]})]}):e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"relative mb-2",children:[e.jsx(K,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search customers (min. 3 characters)...",value:l,onChange:s=>N(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),s.stopPropagation())},className:"w-full pl-8 pr-3 py-2 text-sm border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-card text-foreground placeholder-muted-foreground",autoFocus:!0})]}),e.jsx("div",{className:"max-h-[200px] overflow-y-auto",children:t?e.jsx("div",{className:"py-6 text-center text-sm text-muted-foreground",children:"Searching..."}):l.length>0&&l.length<3?e.jsx("div",{className:"py-6 text-center text-sm text-muted-foreground",children:"Type at least 3 characters to search"}):l.length>=3&&d.length===0?e.jsx("div",{className:"py-6 text-center text-sm text-muted-foreground",children:"No customers found."}):d.length>0?e.jsx("div",{className:"space-y-1",children:d.map(s=>e.jsxs("div",{onClick:a=>{a.preventDefault(),a.stopPropagation(),H(s)},className:y("flex items-center gap-2 p-2 rounded-md cursor-pointer transition-colors border",m===s.customer_id?"bg-purple-50 dark:bg-purple-900 border-purple":"hover:bg-purple-100 dark:hover:bg-purple-800 border-transparent"),children:[e.jsx(M,{className:y("h-4 w-4 text-primary",m===s.customer_id?"opacity-100":"opacity-0")}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-sm text-foreground",children:s.customer_name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.customer_id," â€¢ ",s.customer_email]}),s.subscriptions&&s.subscriptions.length>0&&e.jsxs("div",{className:"text-xs text-primary mt-1",children:[s.subscriptions.length," subscription(s)"]})]})]},s.customer_id))}):e.jsx("div",{className:"py-6 text-center text-sm text-muted-foreground",children:"Start typing to search customers..."})})]})}),u&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:s=>{s.preventDefault(),s.stopPropagation(),r(!1)}})]})}function Se({users:m,subscription:i}){var p;const{data:o,setData:n,post:v,processing:u,errors:r}=Q({customer_id:((p=i==null?void 0:i.customer)==null?void 0:p.customer_id)||"",subscription_id:(i==null?void 0:i.subscription_id)||"",priority:"medium",description:"",notes:"",assigned_to:"unassigned"}),l=t=>{t.preventDefault(),v(route("admin.follow-ups.store"))},N=t=>{n("customer_id",t)},d=t=>{n("subscription_id",t)};return e.jsxs(J,{children:[e.jsx(V,{title:"Create Follow Up"}),e.jsxs("div",{className:"container mx-auto space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(D,{href:route("admin.follow-ups.index"),className:"inline-flex h-10 items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-medium ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50",children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Back to Follow Ups"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Create Follow Up"}),e.jsx("p",{className:"text-muted-foreground",children:"Create a new customer follow up"})]})]}),e.jsxs(F,{children:[e.jsx(T,{children:e.jsx(P,{children:"Follow Up Details"})}),e.jsx(A,{children:e.jsxs("form",{onSubmit:l,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"customer_id",children:"Customer *"}),e.jsx(Y,{value:o.customer_id,onValueChange:N,onSubscriptionChange:d,disabled:!!i,placeholder:"Search and select customer..."}),r.customer_id&&e.jsx("p",{className:"text-sm text-red-600",children:r.customer_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"subscription_id",children:"Subscription ID (Optional)"}),e.jsx(G,{id:"subscription_id",value:o.subscription_id,onChange:t=>n("subscription_id",t.target.value),placeholder:"Enter subscription ID",disabled:!!i}),r.subscription_id&&e.jsx("p",{className:"text-sm text-red-600",children:r.subscription_id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"priority",children:"Priority *"}),e.jsxs(L,{value:o.priority,onValueChange:t=>n("priority",t),children:[e.jsx(R,{children:e.jsx(U,{placeholder:"Select priority"})}),e.jsxs(E,{children:[e.jsx(f,{value:"low",children:"Low"}),e.jsx(f,{value:"medium",children:"Medium"}),e.jsx(f,{value:"high",children:"High"}),e.jsx(f,{value:"urgent",children:"Urgent"})]})]}),r.priority&&e.jsx("p",{className:"text-sm text-red-600",children:r.priority})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"assigned_to",children:"Assigned To"}),e.jsxs(L,{value:o.assigned_to,onValueChange:t=>n("assigned_to",t),children:[e.jsx(R,{children:e.jsx(U,{placeholder:"Select user"})}),e.jsxs(E,{children:[e.jsx(f,{value:"unassigned",children:"Not Assigned"}),m.map(t=>e.jsx(f,{value:t.id.toString(),children:t.name},t.id))]})]}),r.assigned_to&&e.jsx("p",{className:"text-sm text-red-600",children:r.assigned_to})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"description",children:"Description"}),e.jsx(I,{id:"description",value:o.description,onChange:t=>n("description",t.target.value),placeholder:"Describe the follow up requirement...",rows:4}),r.description&&e.jsx("p",{className:"text-sm text-red-600",children:r.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"notes",children:"Additional Notes"}),e.jsx(I,{id:"notes",value:o.notes,onChange:t=>n("notes",t.target.value),placeholder:"Any additional notes...",rows:3}),r.notes&&e.jsx("p",{className:"text-sm text-red-600",children:r.notes})]}),i&&e.jsxs(F,{className:"bg-muted/50",children:[e.jsx(T,{className:"pb-3",children:e.jsx(P,{className:"text-base",children:"Subscription Information"})}),e.jsx(A,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Subscription ID"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.subscription_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Description"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.subscription_description||"N/A"})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-6",children:[e.jsxs(j,{type:"submit",disabled:u,className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),u?"Creating...":"Create Follow Up"]}),e.jsx(D,{href:route("admin.follow-ups.index"),children:e.jsx(j,{type:"button",variant:"outline",children:"Cancel"})})]})]})})]})]})]})}export{Se as default};
