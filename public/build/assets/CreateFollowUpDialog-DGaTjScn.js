import{r as x,j as e}from"./app-Ci8v6MrU.js";import{B as f}from"./createLucideIcon-D00yv57C.js";import{D as F,a as T,b as k,c as A,e as E}from"./dialog-CLW4o-7o.js";import{L as d}from"./label-CkP74dud.js";import{S as b,a as N,b as S,c as v,d as n}from"./select-D2c9BwBa.js";import{T as C}from"./textarea-Dx5n78-a.js";import{C as L}from"./circle-alert-fKGL657e.js";import{L as U}from"./loader-circle-CkNWvUP5.js";import"./index-CBB6N_tQ.js";import"./index-de0Lxc7d.js";import"./index-Rg3zaoIu.js";import"./index-DDGoCjQ0.js";import"./index-CWMKBz9E.js";import"./index-CjJcgxXh.js";import"./index-SNZ2oUW7.js";import"./index-STlN5Ses.js";import"./chevron-down-Du86AyeO.js";import"./chevron-up-BUsFiYjA.js";function $({isOpen:w,onClose:h,maintenance:t,onFollowUpCreated:D}){var y;const[a,m]=x.useState({priority:"medium",description:"",notes:"",assigned_to:"unassigned"}),[r,o]=x.useState({}),[u,g]=x.useState(!1),_=async s=>{var c;if(s.preventDefault(),!!t){g(!0),o({});try{const i=await fetch(route("admin.maintenances.create-follow-up",t.ticket_id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((c=document.querySelector('meta[name="csrf-token"]'))==null?void 0:c.getAttribute("content"))||""},body:JSON.stringify(a)}),p=await i.json();i.ok?(m({priority:"medium",description:"",notes:"",assigned_to:"unassigned"}),D(),h()):p.errors?o(p.errors):o({general:p.message||"An error occurred"})}catch{o({general:"Network error occurred"})}finally{g(!1)}}},l=(s,c)=>{m(i=>({...i,[s]:c})),r[s]&&o(i=>({...i,[s]:""}))},j=()=>{m({priority:"medium",description:"",notes:"",assigned_to:"unassigned"}),o({}),h()};return e.jsx(F,{open:w,onOpenChange:j,children:e.jsxs(T,{className:"sm:max-w-[500px]",children:[e.jsx(k,{children:e.jsx(A,{children:"Create Follow Up"})}),t&&e.jsxs("div",{className:"mb-4 rounded-lg bg-gray-50 p-3",children:[e.jsx("h4",{className:"mb-2 text-sm font-medium text-gray-700",children:"Maintenance Details"}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Ticket ID:"})," ",t.ticket_id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Customer:"})," ",(y=t.customer)==null?void 0:y.customer_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Subject:"})," ",t.subject_problem]}),t.subscription&&e.jsxs("p",{children:[e.jsx("strong",{children:"Subscription:"})," ",t.subscription.subscription_description]})]})]}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[r.general&&e.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-red-50 p-3 text-red-700",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:r.general})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"priority",children:"Priority"}),e.jsxs(b,{value:a.priority,onValueChange:s=>l("priority",s),children:[e.jsx(N,{children:e.jsx(S,{placeholder:"Select priority"})}),e.jsxs(v,{children:[e.jsx(n,{value:"low",children:"Low"}),e.jsx(n,{value:"medium",children:"Medium"}),e.jsx(n,{value:"high",children:"High"}),e.jsx(n,{value:"urgent",children:"Urgent"})]})]}),r.priority&&e.jsx("p",{className:"text-sm text-red-600",children:r.priority})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"description",children:"Description"}),e.jsx(C,{id:"description",value:a.description,onChange:s=>l("description",s.target.value),placeholder:"Enter follow up description...",className:"min-h-[100px]"}),r.description&&e.jsx("p",{className:"text-sm text-red-600",children:r.description})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"notes",children:"Notes"}),e.jsx(C,{id:"notes",value:a.notes,onChange:s=>l("notes",s.target.value),placeholder:"Additional notes...",className:"min-h-[80px]"}),r.notes&&e.jsx("p",{className:"text-sm text-red-600",children:r.notes})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"assigned_to",children:"Assign To"}),e.jsxs(b,{value:a.assigned_to,onValueChange:s=>l("assigned_to",s),children:[e.jsx(N,{children:e.jsx(S,{placeholder:"Select assignee"})}),e.jsx(v,{children:e.jsx(n,{value:"unassigned",children:"Unassigned"})})]}),r.assigned_to&&e.jsx("p",{className:"text-sm text-red-600",children:r.assigned_to})]}),e.jsxs(E,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:j,children:"Cancel"}),e.jsx(f,{type:"submit",disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Follow Up"})]})]})]})})}export{$ as default};
