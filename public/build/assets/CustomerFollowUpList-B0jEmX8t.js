import{r as o,j as e,t as ee,S as be}from"./app-DydvzzJZ.js";import{B as N}from"./badge-Dw-2ux4L.js";import{B as c,c as I}from"./createLucideIcon-B8g3hsTz.js";import{C as se,a as te,b as ve,d as we,c as ye}from"./card-Cr_lE87H.js";import{D as Se,a as Ce,b as _e,c as ke,d as Ae}from"./dialog-ZNhD1JMQ.js";import{I as L}from"./input-D_920G0P.js";import{u as Te,N as De}from"./notification-BFkXGwIn.js";import{S as b,a as v,b as w,c as y,d as i}from"./select-Cy3nKHEB.js";import{F as Pe}from"./filter-r3XUSz7_.js";import{S as Fe}from"./search-CLLDnQAm.js";import{L as E}from"./loader-circle-Dilp_u0o.js";import{X as ae}from"./index-eNSZ6-Jd.js";import{C as Ue}from"./chevron-left-CzszuuzQ.js";import{C as Ie}from"./chevron-right-Vcumhzzq.js";import{U as z}from"./user-plus-dFJZFWBa.js";import{T as Le}from"./triangle-alert-BRTphUve.js";import{C as Ee}from"./clock-BC_WsjUJ.js";import{E as ze}from"./eye-DCF0vRlt.js";import{S as Me}from"./square-pen-CtAVFhHi.js";import{T as Oe}from"./trash-2-XXLBFlUY.js";import"./index-Dw58XjTL.js";import"./index-B-nnM25K.js";import"./index-D1GKDT0r.js";import"./index-BrIE_P40.js";import"./alert-OCX0MC9z.js";import"./circle-x-bVHDCw4C.js";import"./circle-check-big-cmi2138m.js";import"./index-DKGcT16G.js";import"./index-Dht5mKOf.js";import"./index-BDMRWnRc.js";import"./chevron-down-BiiGhmOA.js";const M={pending:{label:"Pending",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"},in_progress:{label:"In Progress",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"},completed:{label:"Completed",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"},cancelled:{label:"Cancelled",className:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}},O={low:{label:"Low",className:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"},medium:{label:"Medium",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"},high:{label:"High",className:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300"},urgent:{label:"Urgent",className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}};function js({initialFilters:m={},users:re}){var J,K,Q,W,G;const S=()=>new Date().toISOString().split("T")[0],h=re.filter(s=>!s.roles||s.roles.length===0?!1:s.roles.some(t=>{const a=t.name.toLowerCase();return a.includes("sales")||a.includes("sale")})),[n,le]=o.useState(null),[p,V]=o.useState(!1),[r,u]=o.useState({search:m.search||"",status:m.status||"all",priority:m.priority||"all",assigned_to:m.assigned_to||"all",date_from:m.date_from||S(),date_to:m.date_to||S(),sort:m.sort||"created_at",direction:m.direction||"desc"}),[x,q]=o.useState(1),[C,ne]=o.useState(15),[D,ie]=o.useState(!1),[H,oe]=o.useState(""),[ce,_]=o.useState(!1),[l,R]=o.useState(null),[j,P]=o.useState("unassigned"),[F,$]=o.useState(!1),{notification:k,showNotification:f,hideNotification:de}=Te(),me=(s,t)=>{let a;return(...d)=>{clearTimeout(a),a=setTimeout(()=>s(...d),t)}},g=o.useCallback(async(s=1,t=r,a=!1)=>{var T;const d={page:s,per_page:C,...t},A=JSON.stringify(d);if(!(!a&&A===H)){V(!0),oe(A);try{const Z=await(await fetch("/admin/follow-ups/table-data",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((T=document.querySelector('meta[name="csrf-token"]'))==null?void 0:T.getAttribute("content"))||""},body:JSON.stringify(d)})).json();le(Z),q(Z.current_page)}catch(Y){console.error("Failed to fetch data:",Y)}finally{V(!1)}}},[C,H]),ue=o.useCallback(me((s,t)=>{g(s,t,!0)},300),[]);o.useEffect(()=>{g(1,r,!0)},[]),o.useEffect(()=>{n&&g(1,r,!0)},[C]),o.useEffect(()=>{n&&ue(1,r)},[r]);const xe=s=>{s.preventDefault()},U=s=>{s>=1&&s<=((n==null?void 0:n.last_page)||1)&&g(s,r,!0)},he=s=>{const t=r.sort===s&&r.direction==="asc"?"desc":"asc";u(a=>({...a,sort:s,direction:t}))},pe=()=>{const s={search:"",status:"all",priority:"all",assigned_to:"all",date_from:S(),date_to:S(),sort:"created_at",direction:"desc"};u(s),q(1)},ge=s=>{var t;R(s),P(((t=s.assignee)==null?void 0:t.id.toString())||"unassigned"),_(!0)},je=async()=>{var s,t;if(l){$(!0);try{const a=await fetch(`/admin/follow-ups/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||"","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({customer_id:l.customer_id,subscription_id:l.subscription_id||"",priority:l.priority,status:l.status,description:l.description,notes:l.notes||"",resolution:l.resolution||"",assigned_to:j==="unassigned"?"":j})});if(a.ok){const d=await a.json();_(!1),R(null),P("unassigned"),g(x,r,!0);const A=j==="unassigned"?"Unassigned":((t=h.find(T=>T.id.toString()===j))==null?void 0:t.name)||"User";f("success","Assignment Successful!",`Follow up #${l.id} has been successfully assigned to ${A}.`)}else{const d=await a.text();console.error("Failed to assign user:",a.status,d),f("error","Assignment Failed","An error occurred while assigning the user. Please try again.")}}catch(a){console.error("Error assigning user:",a),f("error","Network Error","A network error occurred while assigning the user. Please check your connection and try again.")}finally{$(!1)}}},fe=async s=>{confirm("Are you sure you want to delete this follow up? This action cannot be undone.")&&be.delete(route("admin.follow-ups.destroy",s),{onSuccess:()=>{g(x,r,!0),f("success","Follow Up Deleted",`Follow up #${s} has been successfully deleted.`)},onError:t=>{console.error("Error deleting follow up:",t),f("error","Delete Failed","An error occurred while deleting the follow up. Please try again.")}})},X=s=>new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Ne=({field:s})=>r.sort!==s?e.jsx("span",{className:"text-gray-400",children:"↕"}):r.direction==="asc"?e.jsx("span",{children:"↑"}):e.jsx("span",{children:"↓"}),B=[{header:"ID",className:"min-w-[80px]",sortable:!0,render:s=>e.jsxs("div",{className:"font-medium",children:["#",s.id]})},{header:"Customer",className:"min-w-[180px]",sortable:!0,render:s=>{var t,a;return e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:(t=s.customer)==null?void 0:t.customer_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:(a=s.customer)==null?void 0:a.customer_email}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: ",s.customer_id]})]})}},{header:"Subscription",className:"min-w-[140px]",render:s=>{var t,a;return e.jsx("div",{children:s.subscription_id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-medium",children:s.subscription_id}),e.jsx("div",{className:"max-w-[120px] truncate text-xs text-muted-foreground",title:(t=s.subscription)==null?void 0:t.subscription_description,children:(a=s.subscription)==null?void 0:a.subscription_description})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"N/A"})})}},{header:"Status",className:"min-w-[100px]",sortable:!0,render:s=>{const t=M[s.status];return e.jsx(N,{className:t==null?void 0:t.className,children:t==null?void 0:t.label})}},{header:"Priority",className:"min-w-[100px]",sortable:!0,render:s=>{const t=O[s.priority];return e.jsx(N,{className:t==null?void 0:t.className,children:t==null?void 0:t.label})}},{header:"Assigned To",className:"min-w-[120px]",render:s=>e.jsx("div",{className:"text-sm font-medium",children:s.assignee?s.assignee.name:e.jsx(N,{variant:"destructive",children:"Unassigned"})})},{header:"Description",className:"min-w-[200px]",render:s=>e.jsx("div",{className:"max-w-[200px] truncate text-sm",title:s.description,children:s.description})},{header:"Notes",className:"min-w-[200px]",render:s=>e.jsx("div",{className:"max-w-[200px] truncate text-sm",title:s.notes,children:s.notes||e.jsx("span",{className:"text-muted-foreground",children:"No notes"})})},{header:"Created",className:"min-w-[120px]",sortable:!0,render:s=>e.jsxs("div",{className:"text-sm",children:[X(s.created_at),s.is_overdue&&e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-red-600",children:[e.jsx(Le,{className:"h-3 w-3"}),"Overdue"]})]})},{header:"Completed",className:"min-w-[120px]",render:s=>e.jsx("div",{className:"text-sm",children:s.completed_at?e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(Ee,{className:"h-3 w-3"}),X(s.completed_at)]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})})},{header:"Actions",className:"min-w-[200px]",render:s=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ee,{href:`/admin/follow-ups/${s.id}`,children:e.jsx(c,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",title:"View Details",children:e.jsx(ze,{className:"h-4 w-4"})})}),e.jsx(c,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 text-blue-600 hover:bg-blue-50 hover:text-blue-700",title:"Quick Assign",onClick:()=>ge(s),children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx(ee,{href:`/admin/follow-ups/${s.id}/edit`,children:e.jsx(c,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",title:"Edit Follow Up",children:e.jsx(Me,{className:"h-4 w-4"})})}),e.jsx(c,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50 hover:text-red-700",title:"Delete Follow Up",onClick:()=>fe(s.id),children:e.jsx(Oe,{className:"h-4 w-4"})})]})}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx(De,{show:k.show,type:k.type,title:k.title,message:k.message,onClose:de,autoHide:!0,duration:5e3,position:"top-right"}),e.jsx(se,{children:e.jsxs(te,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ve,{children:"Follow Up Management"}),e.jsx(we,{children:"Manage and track customer follow ups"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>ie(!D),className:I("gap-2",D&&"bg-muted"),children:[e.jsx(Pe,{className:"h-4 w-4"}),"Filters"]})})]}),e.jsxs("form",{onSubmit:xe,className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Fe,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(L,{placeholder:"Search by customer name, email, description...",value:r.search,onChange:s=>u(t=>({...t,search:s.target.value})),className:"pl-9"})]}),e.jsx(c,{type:"submit",size:"sm",disabled:p,children:p?e.jsx(E,{className:"h-4 w-4 animate-spin"}):"Search"}),(r.search||r.status!=="all"||r.priority!=="all"||r.assigned_to!=="all"||r.date_from||r.date_to)&&e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:pe,children:[e.jsx(ae,{className:"h-4 w-4"}),"Clear"]})]}),D&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 pt-4 md:grid-cols-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(b,{value:r.status,onValueChange:s=>u(t=>({...t,status:s})),children:[e.jsx(v,{children:e.jsx(w,{placeholder:"All Status"})}),e.jsxs(y,{children:[e.jsx(i,{value:"all",children:"All Status"}),e.jsx(i,{value:"pending",children:"Pending"}),e.jsx(i,{value:"in_progress",children:"In Progress"}),e.jsx(i,{value:"completed",children:"Completed"}),e.jsx(i,{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Priority"}),e.jsxs(b,{value:r.priority,onValueChange:s=>u(t=>({...t,priority:s})),children:[e.jsx(v,{children:e.jsx(w,{placeholder:"All Priorities"})}),e.jsxs(y,{children:[e.jsx(i,{value:"all",children:"All Priorities"}),e.jsx(i,{value:"low",children:"Low"}),e.jsx(i,{value:"medium",children:"Medium"}),e.jsx(i,{value:"high",children:"High"}),e.jsx(i,{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Assigned To (Sales)"}),e.jsxs(b,{value:r.assigned_to,onValueChange:s=>u(t=>({...t,assigned_to:s})),children:[e.jsx(v,{children:e.jsx(w,{placeholder:"All Sales Users"})}),e.jsxs(y,{children:[e.jsx(i,{value:"all",children:"All Sales Users"}),e.jsx(i,{value:"unassigned",children:"Unassigned"}),h.map(s=>e.jsx(i,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.name}),s.roles&&s.roles.length>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",s.roles.map(t=>t.name).join(", "),")"]})]})},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Date From"}),e.jsx(L,{type:"date",value:r.date_from,onChange:s=>u(t=>({...t,date_from:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Date To"}),e.jsx(L,{type:"date",value:r.date_to,onChange:s=>u(t=>({...t,date_to:s.target.value}))})]})]})]})}),e.jsxs(se,{children:[e.jsx(te,{className:"pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",(n==null?void 0:n.from)||0," to ",(n==null?void 0:n.to)||0," of ",(n==null?void 0:n.total)||0," entries"]}),e.jsxs(b,{value:C.toString(),onValueChange:s=>ne(parseInt(s)),children:[e.jsx(v,{className:"w-20",children:e.jsx(w,{})}),e.jsxs(y,{children:[e.jsx(i,{value:"15",children:"15"}),e.jsx(i,{value:"25",children:"25"}),e.jsx(i,{value:"50",children:"50"}),e.jsx(i,{value:"100",children:"100"})]})]})]})})}),e.jsx(ye,{className:"p-0",children:e.jsxs("div",{className:"relative",children:[p&&e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-background/50",children:e.jsx(E,{className:"h-8 w-8 animate-spin"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b",children:B.map((s,t)=>e.jsx("th",{className:I("p-3 text-left font-medium",s.className,s.sortable&&"cursor-pointer hover:bg-muted/50"),onClick:()=>s.sortable&&he(s.header.toLowerCase().replace(" ","_")),children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.header,s.sortable&&e.jsx(Ne,{field:s.header.toLowerCase().replace(" ","_")})]})},t))})}),e.jsx("tbody",{children:n==null?void 0:n.data.map((s,t)=>e.jsx("tr",{className:"border-b hover:bg-muted/50",children:B.map((a,d)=>e.jsx("td",{className:I("p-3",a.className),children:a.render(s)},d))},t))})]})})]})})]}),n&&n.last_page>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>U(x-1),disabled:x<=1||p,children:[e.jsx(Ue,{className:"h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"flex gap-1",children:[...Array(Math.min(5,n.last_page))].map((s,t)=>{const a=Math.max(1,Math.min(n.last_page-4,Math.max(1,x-2)))+t;return a<=n.last_page?e.jsx(c,{variant:x===a?"default":"outline",size:"sm",onClick:()=>U(a),disabled:p,className:"min-w-[40px]",children:a},a):null})}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>U(x+1),disabled:x>=n.last_page||p,children:["Next",e.jsx(Ie,{className:"h-4 w-4"})]})]}),e.jsx(Se,{open:ce,onOpenChange:_,children:e.jsxs(Ce,{className:"sm:max-w-[500px]",children:[e.jsxs(_e,{className:"pb-4",children:[e.jsx(ke,{className:"text-lg font-semibold",children:"Quick Assign Follow Up"}),e.jsxs(Ae,{className:"text-sm text-muted-foreground",children:["Assign follow up #",l==null?void 0:l.id," to a sales user for efficient task management"]})]}),e.jsxs("div",{className:"space-y-6",children:[l&&e.jsxs("div",{className:"rounded-lg border bg-card p-4",children:[e.jsx("h4",{className:"mb-3 text-sm font-semibold text-foreground",children:"Follow Up Details"}),e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Customer:"}),e.jsx("span",{className:"text-sm font-medium",children:(J=l.customer)==null?void 0:J.customer_name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Customer ID:"}),e.jsx("span",{className:"font-mono text-sm",children:l.customer_id})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Priority:"}),e.jsx(N,{className:(K=O[l.priority])==null?void 0:K.className,children:(Q=O[l.priority])==null?void 0:Q.label})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),e.jsx(N,{className:(W=M[l.status])==null?void 0:W.className,children:(G=M[l.status])==null?void 0:G.label})]}),l.description&&e.jsxs("div",{className:"border-t pt-2",children:[e.jsx("span",{className:"mb-1 block text-sm text-muted-foreground",children:"Description:"}),e.jsx("p",{className:"rounded bg-muted/50 p-2 text-sm text-wrap text-foreground",children:l.description})]}),l.assignee&&e.jsxs("div",{className:"flex items-center justify-between border-t pt-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Currently Assigned:"}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:l.assignee.name})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Assign to Sales User"}),e.jsxs(b,{value:j,onValueChange:P,children:[e.jsx(v,{className:"w-full",children:e.jsx(w,{placeholder:"Select a sales user..."})}),e.jsxs(y,{children:[e.jsx(i,{value:"unassigned",className:"text-muted-foreground",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Unassign (No user)"]})}),h.length>0?h.map(s=>e.jsx(i,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("div",{children:e.jsx("div",{className:"font-medium",children:s.name})})]})},s.id)):e.jsx(i,{value:"no-sales",disabled:!0,className:"text-muted-foreground",children:"No sales users available"})]})]}),h.length===0&&e.jsx("p",{className:"rounded bg-amber-50 p-2 text-xs text-amber-600",children:"⚠️ No users with sales roles found. Please ensure users have proper role assignments."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t pt-6",children:[e.jsx(c,{variant:"outline",onClick:()=>_(!1),disabled:F,children:"Cancel"}),e.jsx(c,{onClick:je,disabled:F||h.length===0,className:"min-w-[100px]",children:F?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),"Assigning..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Assign"]})})]})]})})]})}export{js as default};
