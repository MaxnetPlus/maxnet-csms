import{r as o,j as e,t as se,S as ve}from"./app-Ci8v6MrU.js";import{B as N}from"./badge-BIBJLQYD.js";import{B as c,c as U}from"./createLucideIcon-D00yv57C.js";import{C as te,a as ae,b as we,d as ye,c as Se}from"./card-ByE5s6QK.js";import{D as Ce,a as _e,b as ke,c as Ae,d as De}from"./dialog-CLW4o-7o.js";import{I}from"./input-DnuT7wtE.js";import{u as Fe,N as Te}from"./notification-DzGbbxpZ.js";import{S as b,a as v,b as w,c as y,d as i}from"./select-D2c9BwBa.js";import{F as Pe}from"./filter-Cez0vueW.js";import{S as Ue}from"./search-D6KFkx-7.js";import{L as E}from"./loader-circle-CkNWvUP5.js";import{X as re}from"./index-Rg3zaoIu.js";import{C as Ie}from"./chevron-left-DmyxnLB3.js";import{C as Ee}from"./chevron-right-CupTmoq7.js";import{U as L}from"./user-plus-DPX4hucb.js";import{T as Le}from"./triangle-alert-kmcL1q5q.js";import{C as Me}from"./clock-D7wX5m9f.js";import{E as ze}from"./eye-BL1W-KhU.js";import{S as Oe}from"./square-pen-Q4hxE-3W.js";import{T as Ve}from"./trash-2-DGME01fH.js";import"./index-CBB6N_tQ.js";import"./index-de0Lxc7d.js";import"./index-CWMKBz9E.js";import"./index-DDGoCjQ0.js";import"./alert-BU8Q5t3S.js";import"./circle-x-9yNyXqHl.js";import"./circle-check-big-lmGurD1_.js";import"./index-CjJcgxXh.js";import"./index-SNZ2oUW7.js";import"./index-STlN5Ses.js";import"./chevron-down-Du86AyeO.js";import"./chevron-up-BUsFiYjA.js";const M={pending:{label:"Pending",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"},in_progress:{label:"In Progress",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"},completed:{label:"Completed",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"},cancelled:{label:"Cancelled",className:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}},z={low:{label:"Low",className:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"},medium:{label:"Medium",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"},high:{label:"High",className:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300"},urgent:{label:"Urgent",className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}};function Ns({initialFilters:m={},users:le}){var K,Q,Y,W,G;const O=()=>{const s=new Date;return new Date(s.getFullYear(),s.getMonth(),1).toISOString().split("T")[0]},V=()=>{const s=new Date;return new Date(s.getFullYear(),s.getMonth()+1,0).toISOString().split("T")[0]},h=le.filter(s=>!s.roles||s.roles.length===0?!1:s.roles.some(t=>{const a=t.name.toLowerCase();return a.includes("sales")||a.includes("sale")})),[n,ne]=o.useState(null),[p,q]=o.useState(!1),[r,u]=o.useState({search:m.search||"",status:m.status||"all",priority:m.priority||"all",assigned_to:m.assigned_to||"all",date_from:m.date_from||O(),date_to:m.date_to||V(),sort:m.sort||"created_at",direction:m.direction||"desc"}),[x,H]=o.useState(1),[S,ie]=o.useState(15),[D,oe]=o.useState(!1),[R,ce]=o.useState(""),[de,C]=o.useState(!1),[l,$]=o.useState(null),[j,F]=o.useState("unassigned"),[T,X]=o.useState(!1),{notification:_,showNotification:f,hideNotification:me}=Fe(),ue=(s,t)=>{let a;return(...d)=>{clearTimeout(a),a=setTimeout(()=>s(...d),t)}},g=o.useCallback(async(s=1,t=r,a=!1)=>{var A;const d={page:s,per_page:S,...t},k=JSON.stringify(d);if(!(!a&&k===R)){q(!0),ce(k);try{const ee=await(await fetch("/admin/follow-ups/table-data",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((A=document.querySelector('meta[name="csrf-token"]'))==null?void 0:A.getAttribute("content"))||""},body:JSON.stringify(d)})).json();ne(ee),H(ee.current_page)}catch(Z){console.error("Failed to fetch data:",Z)}finally{q(!1)}}},[S,R]),xe=o.useCallback(ue((s,t)=>{g(s,t,!0)},300),[]);o.useEffect(()=>{g(1,r,!0)},[]),o.useEffect(()=>{n&&g(1,r,!0)},[S]),o.useEffect(()=>{n&&xe(1,r)},[r]);const he=s=>{s.preventDefault()},P=s=>{s>=1&&s<=((n==null?void 0:n.last_page)||1)&&g(s,r,!0)},pe=s=>{const t=r.sort===s&&r.direction==="asc"?"desc":"asc";u(a=>({...a,sort:s,direction:t}))},ge=()=>{const s={search:"",status:"all",priority:"all",assigned_to:"all",date_from:O(),date_to:V(),sort:"created_at",direction:"desc"};u(s),H(1)},je=s=>{var t;$(s),F(((t=s.assignee)==null?void 0:t.id.toString())||"unassigned"),C(!0)},fe=async()=>{var s,t;if(l){X(!0);try{const a=await fetch(`/admin/follow-ups/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||"","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({customer_id:l.customer_id,subscription_id:l.subscription_id||"",priority:l.priority,status:l.status,description:l.description,notes:l.notes||"",resolution:l.resolution||"",assigned_to:j==="unassigned"?"":j})});if(a.ok){const d=await a.json();C(!1),$(null),F("unassigned"),g(x,r,!0);const k=j==="unassigned"?"Unassigned":((t=h.find(A=>A.id.toString()===j))==null?void 0:t.name)||"User";f("success","Assignment Successful!",`Follow up #${l.id} has been successfully assigned to ${k}.`)}else{const d=await a.text();console.error("Failed to assign user:",a.status,d),f("error","Assignment Failed","An error occurred while assigning the user. Please try again.")}}catch(a){console.error("Error assigning user:",a),f("error","Network Error","A network error occurred while assigning the user. Please check your connection and try again.")}finally{X(!1)}}},Ne=async s=>{confirm("Are you sure you want to delete this follow up? This action cannot be undone.")&&ve.delete(route("admin.follow-ups.destroy",s),{onSuccess:()=>{g(x,r,!0),f("success","Follow Up Deleted",`Follow up #${s} has been successfully deleted.`)},onError:t=>{console.error("Error deleting follow up:",t),f("error","Delete Failed","An error occurred while deleting the follow up. Please try again.")}})},B=s=>new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),be=({field:s})=>r.sort!==s?e.jsx("span",{className:"text-gray-400",children:"↕"}):r.direction==="asc"?e.jsx("span",{children:"↑"}):e.jsx("span",{children:"↓"}),J=[{header:"ID",className:"min-w-[80px]",sortable:!0,render:s=>e.jsxs("div",{className:"font-medium",children:["#",s.id]})},{header:"Customer",className:"min-w-[180px]",sortable:!0,render:s=>{var t,a;return e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:(t=s.customer)==null?void 0:t.customer_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:(a=s.customer)==null?void 0:a.customer_email}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: ",s.customer_id]})]})}},{header:"Subscription",className:"min-w-[140px]",render:s=>{var t,a;return e.jsx("div",{children:s.subscription_id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-medium",children:s.subscription_id}),e.jsx("div",{className:"max-w-[120px] truncate text-xs text-muted-foreground",title:(t=s.subscription)==null?void 0:t.subscription_description,children:(a=s.subscription)==null?void 0:a.subscription_description})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"N/A"})})}},{header:"Status",className:"min-w-[100px]",sortable:!0,render:s=>{const t=M[s.status];return e.jsx(N,{className:t==null?void 0:t.className,children:t==null?void 0:t.label})}},{header:"Priority",className:"min-w-[100px]",sortable:!0,render:s=>{const t=z[s.priority];return e.jsx(N,{className:t==null?void 0:t.className,children:t==null?void 0:t.label})}},{header:"Assigned To",className:"min-w-[120px]",render:s=>e.jsx("div",{className:"text-sm font-medium",children:s.assignee?s.assignee.name:e.jsx(N,{variant:"destructive",children:"Unassigned"})})},{header:"Description",className:"min-w-[200px]",render:s=>e.jsx("div",{className:"max-w-[200px] truncate text-sm",title:s.description,children:s.description})},{header:"Notes",className:"min-w-[200px]",render:s=>e.jsx("div",{className:"max-w-[200px] truncate text-sm",title:s.notes,children:s.notes||e.jsx("span",{className:"text-muted-foreground",children:"No notes"})})},{header:"Created",className:"min-w-[120px]",sortable:!0,render:s=>e.jsxs("div",{className:"text-sm",children:[B(s.created_at),s.is_overdue&&e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-red-600",children:[e.jsx(Le,{className:"h-3 w-3"}),"Overdue"]})]})},{header:"Completed",className:"min-w-[120px]",render:s=>e.jsx("div",{className:"text-sm",children:s.completed_at?e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(Me,{className:"h-3 w-3"}),B(s.completed_at)]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})})},{header:"Actions",className:"min-w-[200px]",render:s=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(se,{href:`/admin/follow-ups/${s.id}`,children:e.jsx(c,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",title:"View Details",children:e.jsx(ze,{className:"h-4 w-4"})})}),e.jsx(c,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 text-blue-600 hover:bg-blue-50 hover:text-blue-700",title:"Quick Assign",onClick:()=>je(s),children:e.jsx(L,{className:"h-4 w-4"})}),e.jsx(se,{href:`/admin/follow-ups/${s.id}/edit`,children:e.jsx(c,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",title:"Edit Follow Up",children:e.jsx(Oe,{className:"h-4 w-4"})})}),e.jsx(c,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50 hover:text-red-700",title:"Delete Follow Up",onClick:()=>Ne(s.id),children:e.jsx(Ve,{className:"h-4 w-4"})})]})}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Te,{show:_.show,type:_.type,title:_.title,message:_.message,onClose:me,autoHide:!0,duration:5e3,position:"top-right"}),e.jsx(te,{children:e.jsxs(ae,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(we,{children:"Follow Up Management"}),e.jsx(ye,{children:"Manage and track customer follow ups"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>oe(!D),className:U("gap-2",D&&"bg-muted"),children:[e.jsx(Pe,{className:"h-4 w-4"}),"Filters"]})})]}),e.jsxs("form",{onSubmit:he,className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ue,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(I,{placeholder:"Search by customer name, email, description...",value:r.search,onChange:s=>u(t=>({...t,search:s.target.value})),className:"pl-9"})]}),e.jsx(c,{type:"submit",size:"sm",disabled:p,children:p?e.jsx(E,{className:"h-4 w-4 animate-spin"}):"Search"}),(r.search||r.status!=="all"||r.priority!=="all"||r.assigned_to!=="all"||r.date_from||r.date_to)&&e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:ge,children:[e.jsx(re,{className:"h-4 w-4"}),"Clear"]})]}),D&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 pt-4 md:grid-cols-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(b,{value:r.status,onValueChange:s=>u(t=>({...t,status:s})),children:[e.jsx(v,{children:e.jsx(w,{placeholder:"All Status"})}),e.jsxs(y,{children:[e.jsx(i,{value:"all",children:"All Status"}),e.jsx(i,{value:"pending",children:"Pending"}),e.jsx(i,{value:"in_progress",children:"In Progress"}),e.jsx(i,{value:"completed",children:"Completed"}),e.jsx(i,{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Priority"}),e.jsxs(b,{value:r.priority,onValueChange:s=>u(t=>({...t,priority:s})),children:[e.jsx(v,{children:e.jsx(w,{placeholder:"All Priorities"})}),e.jsxs(y,{children:[e.jsx(i,{value:"all",children:"All Priorities"}),e.jsx(i,{value:"low",children:"Low"}),e.jsx(i,{value:"medium",children:"Medium"}),e.jsx(i,{value:"high",children:"High"}),e.jsx(i,{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Assigned To (Sales)"}),e.jsxs(b,{value:r.assigned_to,onValueChange:s=>u(t=>({...t,assigned_to:s})),children:[e.jsx(v,{children:e.jsx(w,{placeholder:"All Sales Users"})}),e.jsxs(y,{children:[e.jsx(i,{value:"all",children:"All Sales Users"}),e.jsx(i,{value:"unassigned",children:"Unassigned"}),h.map(s=>e.jsx(i,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.name}),s.roles&&s.roles.length>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",s.roles.map(t=>t.name).join(", "),")"]})]})},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Date From"}),e.jsx(I,{type:"date",value:r.date_from,onChange:s=>u(t=>({...t,date_from:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Date To"}),e.jsx(I,{type:"date",value:r.date_to,onChange:s=>u(t=>({...t,date_to:s.target.value}))})]})]})]})}),e.jsxs(te,{children:[e.jsx(ae,{className:"pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",(n==null?void 0:n.from)||0," to ",(n==null?void 0:n.to)||0," of ",(n==null?void 0:n.total)||0," entries"]}),e.jsxs(b,{value:S.toString(),onValueChange:s=>ie(parseInt(s)),children:[e.jsx(v,{className:"w-20",children:e.jsx(w,{})}),e.jsxs(y,{children:[e.jsx(i,{value:"15",children:"15"}),e.jsx(i,{value:"25",children:"25"}),e.jsx(i,{value:"50",children:"50"}),e.jsx(i,{value:"100",children:"100"})]})]})]})})}),e.jsx(Se,{className:"p-0",children:e.jsxs("div",{className:"relative",children:[p&&e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-background/50",children:e.jsx(E,{className:"h-8 w-8 animate-spin"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b",children:J.map((s,t)=>e.jsx("th",{className:U("p-3 text-left font-medium",s.className,s.sortable&&"cursor-pointer hover:bg-muted/50"),onClick:()=>s.sortable&&pe(s.header.toLowerCase().replace(" ","_")),children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.header,s.sortable&&e.jsx(be,{field:s.header.toLowerCase().replace(" ","_")})]})},t))})}),e.jsx("tbody",{children:n==null?void 0:n.data.map((s,t)=>e.jsx("tr",{className:"border-b hover:bg-muted/50",children:J.map((a,d)=>e.jsx("td",{className:U("p-3",a.className),children:a.render(s)},d))},t))})]})})]})})]}),n&&n.last_page>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>P(x-1),disabled:x<=1||p,children:[e.jsx(Ie,{className:"h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"flex gap-1",children:[...Array(Math.min(5,n.last_page))].map((s,t)=>{const a=Math.max(1,Math.min(n.last_page-4,Math.max(1,x-2)))+t;return a<=n.last_page?e.jsx(c,{variant:x===a?"default":"outline",size:"sm",onClick:()=>P(a),disabled:p,className:"min-w-[40px]",children:a},a):null})}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>P(x+1),disabled:x>=n.last_page||p,children:["Next",e.jsx(Ee,{className:"h-4 w-4"})]})]}),e.jsx(Ce,{open:de,onOpenChange:C,children:e.jsxs(_e,{className:"sm:max-w-[500px]",children:[e.jsxs(ke,{className:"pb-4",children:[e.jsx(Ae,{className:"text-lg font-semibold",children:"Quick Assign Follow Up"}),e.jsxs(De,{className:"text-sm text-muted-foreground",children:["Assign follow up #",l==null?void 0:l.id," to a sales user for efficient task management"]})]}),e.jsxs("div",{className:"space-y-6",children:[l&&e.jsxs("div",{className:"rounded-lg border bg-card p-4",children:[e.jsx("h4",{className:"mb-3 text-sm font-semibold text-foreground",children:"Follow Up Details"}),e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Customer:"}),e.jsx("span",{className:"text-sm font-medium",children:(K=l.customer)==null?void 0:K.customer_name})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Customer ID:"}),e.jsx("span",{className:"font-mono text-sm",children:l.customer_id})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Priority:"}),e.jsx(N,{className:(Q=z[l.priority])==null?void 0:Q.className,children:(Y=z[l.priority])==null?void 0:Y.label})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),e.jsx(N,{className:(W=M[l.status])==null?void 0:W.className,children:(G=M[l.status])==null?void 0:G.label})]}),l.description&&e.jsxs("div",{className:"border-t pt-2",children:[e.jsx("span",{className:"mb-1 block text-sm text-muted-foreground",children:"Description:"}),e.jsx("p",{className:"rounded bg-muted/50 p-2 text-sm text-wrap text-foreground",children:l.description})]}),l.assignee&&e.jsxs("div",{className:"flex items-center justify-between border-t pt-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Currently Assigned:"}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:l.assignee.name})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Assign to Sales User"}),e.jsxs(b,{value:j,onValueChange:F,children:[e.jsx(v,{className:"w-full",children:e.jsx(w,{placeholder:"Select a sales user..."})}),e.jsxs(y,{children:[e.jsx(i,{value:"unassigned",className:"text-muted-foreground",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Unassign (No user)"]})}),h.length>0?h.map(s=>e.jsx(i,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("div",{children:e.jsx("div",{className:"font-medium",children:s.name})})]})},s.id)):e.jsx(i,{value:"no-sales",disabled:!0,className:"text-muted-foreground",children:"No sales users available"})]})]}),h.length===0&&e.jsx("p",{className:"rounded bg-amber-50 p-2 text-xs text-amber-600",children:"⚠️ No users with sales roles found. Please ensure users have proper role assignments."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t pt-6",children:[e.jsx(c,{variant:"outline",onClick:()=>C(!1),disabled:T,children:"Cancel"}),e.jsx(c,{onClick:fe,disabled:T||h.length===0,className:"min-w-[100px]",children:T?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),"Assigning..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Assign"]})})]})]})})]})}export{Ns as default};
