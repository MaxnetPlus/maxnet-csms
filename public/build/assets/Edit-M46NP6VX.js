import{r as b,x as V,j as e,t as I}from"./app-AbhHEEzt.js";import{B as z}from"./badge-CXi-sFWa.js";import{B as m}from"./createLucideIcon-pT0-Q91X.js";import{C as u,a as x,b as h,d as j,c as p}from"./card-CU_by6xK.js";import{I as g}from"./input-B5PTsCd7.js";import{L as n}from"./label-RFuotZO-.js";import{S as T,a as A,b as D,c as $,d}from"./select-B_dwHFsv.js";import{T as F}from"./textarea-CuUI8WE-.js";import{S as G}from"./sales-layout-BMf-STjr.js";import{A as H}from"./arrow-left-DRI48eJi.js";import{T as q}from"./target-BE0rSJVW.js";import{M as B}from"./map-pin-DOyHrmTd.js";import{R as J}from"./rotate-ccw-fb8do9R6.js";import{S as Q}from"./save-uAH9-xpN.js";import"./index-eLpZBC1g.js";import"./index-CpYLbitW.js";import"./index-hPd88Usr.js";import"./index-BfuHw8SX.js";import"./index-BcC-eJW6.js";import"./index-DQZISUI1.js";import"./chevron-down-7pwEJm_p.js";import"./breadcrumbs-UcLjOO33.js";import"./app-logo-DeZBS8gQ.js";import"./index-HIPCc83Z.js";import"./index-CscB6A7L.js";import"./index-Dy4Bikl7.js";import"./chevron-right-Cul208WP.js";import"./chart-column-B53vEJ_M.js";import"./square-check-big-DzvxcFLj.js";function Se({prospect:t,categories:v}){const[_,M]=b.useState(t.latitude&&t.longitude?{lat:t.latitude,lng:t.longitude}:null),[S,o]=b.useState(""),[k,N]=b.useState(!1),[C,L]=b.useState(t.sales_location||""),{data:r,setData:i,put:R,processing:w,errors:a}=V({prospect_category_id:t.prospect_category_id.toString(),customer_name:t.customer_name,customer_email:t.customer_email||"",customer_number:t.customer_number||"",address:t.address||"",sales_location:t.sales_location||"",latitude:t.latitude?t.latitude.toString():"",longitude:t.longitude?t.longitude.toString():"",status:t.status,notes:t.notes||""}),K=s=>{s.preventDefault(),R(`/sales/prospects/${t.id}`)},P=()=>{if(!navigator.geolocation){o("Geolocation tidak didukung oleh browser ini.");return}N(!0),o(""),navigator.geolocation.getCurrentPosition(async s=>{const{latitude:l,longitude:c}=s.coords;M({lat:l,lng:c});try{const f=(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${l}&lon=${c}`)).json()).display_name||`${l}, ${c}`;L(f),i(U=>({...U,latitude:l.toString(),longitude:c.toString(),sales_location:f}))}catch(E){console.error("Error getting address:",E);const y=`${l}, ${c}`;L(y),i(f=>({...f,latitude:l.toString(),longitude:c.toString(),sales_location:y}))}N(!1)},s=>{switch(N(!1),s.code){case s.PERMISSION_DENIED:o("Izin lokasi ditolak. Silakan aktifkan GPS dan izin lokasi.");break;case s.POSITION_UNAVAILABLE:o("Informasi lokasi tidak tersedia.");break;case s.TIMEOUT:o("Permintaan lokasi timeout.");break;default:o("Terjadi kesalahan saat mengambil lokasi.");break}},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})},O=()=>{P()};return e.jsx(G,{breadcrumbs:[{title:"Dashboard",href:"/sales"},{title:"Prospek",href:"/sales/prospects"},{title:t.customer_name,href:`/sales/prospects/${t.id}`},{title:"Edit",href:`/sales/prospects/${t.id}/edit`}],children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(I,{href:`/sales/prospects/${t.id}`,children:e.jsx(H,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Edit Prospek"}),e.jsxs("p",{className:"text-muted-foreground",children:["Edit data prospek: ",t.customer_name]})]})]}),e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Kategori Prospek"]}),e.jsx(j,{children:"Pilih kategori sesuai dengan jenis customer"})]}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"prospect_category_id",children:"Kategori *"}),e.jsxs(T,{value:r.prospect_category_id,onValueChange:s=>i("prospect_category_id",s),children:[e.jsx(A,{children:e.jsx(D,{placeholder:"Pilih kategori prospek"})}),e.jsx($,{children:v&&v.length>0?v.map(s=>e.jsx(d,{value:s.id.toString(),children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("span",{children:s.name}),e.jsxs(z,{variant:"secondary",className:"ml-2",children:[s.points," poin"]})]})},s.id)):e.jsx(d,{value:"no-categories",disabled:!0,children:"Tidak ada kategori tersedia"})})]}),a.prospect_category_id&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:a.prospect_category_id})]}),r.prospect_category_id&&e.jsx("div",{className:"rounded-lg border border-primary/20 bg-primary/10 p-3",children:(()=>{const s=v.find(l=>l.id.toString()===r.prospect_category_id);return s?e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-primary",children:s.name}),e.jsxs("p",{className:"text-sm text-primary/80",children:["Poin yang didapat: ",e.jsx("span",{className:"font-medium",children:s.points})]})]}):null})()})]})})]}),e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Informasi Customer"}),e.jsx(j,{children:"Data kontak dan informasi customer"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"customer_name",children:"Nama Customer *"}),e.jsx(g,{id:"customer_name",type:"text",value:r.customer_name,onChange:s=>i("customer_name",s.target.value),placeholder:"Masukkan nama lengkap customer"}),a.customer_name&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:a.customer_name})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"customer_email",children:"Email"}),e.jsx(g,{id:"customer_email",type:"email",value:r.customer_email,onChange:s=>i("customer_email",s.target.value),placeholder:"customer@email.com"}),a.customer_email&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:a.customer_email})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"customer_number",children:"Nomor Telepon"}),e.jsx(g,{id:"customer_number",type:"tel",value:r.customer_number,onChange:s=>i("customer_number",s.target.value),placeholder:"08xxxxxxxxxx"}),a.customer_number&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:a.customer_number})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"address",children:"Alamat"}),e.jsx(F,{id:"address",value:r.address,onChange:s=>i("address",s.target.value),placeholder:"Alamat lengkap customer",rows:3}),a.address&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:a.address})]})]})]}),e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Status Prospek"}),e.jsx(j,{children:"Update status prospek sesuai dengan progress"})]}),e.jsx(p,{children:e.jsxs("div",{children:[e.jsx(n,{htmlFor:"status",children:"Status *"}),e.jsxs(T,{value:r.status,onValueChange:s=>i("status",s),children:[e.jsx(A,{children:e.jsx(D,{placeholder:"Pilih status"})}),e.jsxs($,{children:[e.jsx(d,{value:"new",children:"Baru"}),e.jsx(d,{value:"contacted",children:"Dihubungi"}),e.jsx(d,{value:"qualified",children:"Terkualifikasi"}),e.jsx(d,{value:"converted",children:"Terkonversi"}),e.jsx(d,{value:"rejected",children:"Ditolak"})]})]}),a.status&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:a.status})]})})]}),e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5"}),"Lokasi Sales & Koordinat"]}),e.jsx(j,{children:"Update lokasi sales dan koordinat"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row",children:[e.jsx(m,{type:"button",variant:"outline",onClick:P,disabled:k,className:"flex items-center gap-2",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}),e.jsx("span",{children:"Mengambil lokasi..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{children:"Ambil Lokasi Saat Ini"})]})}),e.jsxs(m,{type:"button",variant:"outline",onClick:O,disabled:k,className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{children:"Refresh Lokasi"})]})]}),S&&e.jsx("div",{className:"rounded-lg border border-destructive/20 bg-destructive/10 p-3 text-sm text-destructive",children:S}),C&&e.jsxs("div",{className:"rounded-lg border border-green-200 bg-green-50 p-3 text-sm text-green-800",children:[e.jsx("p",{className:"font-medium",children:"Lokasi Sales:"}),e.jsx("p",{children:C})]}),_&&e.jsxs("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-3 text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium",children:"Koordinat:"}),e.jsxs("p",{children:["Latitude: ",_.lat]}),e.jsxs("p",{children:["Longitude: ",_.lng]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"latitude",children:"Latitude"}),e.jsx(g,{id:"latitude",type:"number",step:"any",value:r.latitude,onChange:s=>i("latitude",s.target.value),placeholder:"Contoh: -6.2088"}),a.latitude&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:a.latitude})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"longitude",children:"Longitude"}),e.jsx(g,{id:"longitude",type:"number",step:"any",value:r.longitude,onChange:s=>i("longitude",s.target.value),placeholder:"Contoh: 106.8456"}),a.longitude&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:a.longitude})]})]})]})]}),e.jsxs(u,{children:[e.jsxs(x,{children:[e.jsx(h,{children:"Catatan"}),e.jsx(j,{children:"Informasi tambahan tentang prospek ini"})]}),e.jsxs(p,{children:[e.jsx(F,{value:r.notes,onChange:s=>i("notes",s.target.value),placeholder:"Catatan tambahan tentang prospek, kebutuhan, atau informasi penting lainnya...",rows:4}),a.notes&&e.jsx("p",{className:"mt-1 text-sm text-destructive",children:a.notes})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row",children:[e.jsxs(m,{type:"submit",disabled:w,className:"flex-1 sm:flex-none",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),w?"Menyimpan...":"Simpan Perubahan"]}),e.jsx(m,{variant:"outline",asChild:!0,className:"flex-1 sm:flex-none",children:e.jsx(I,{href:`/sales/prospects/${t.id}`,children:"Batal"})})]})]})]})})}export{Se as default};
