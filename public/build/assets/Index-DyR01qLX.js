import{J as $,r as x,j as e,Q as B,t,S as c}from"./app-Caplvkbj.js";import{B as w}from"./badge-BUNMX9Pk.js";import{B as a}from"./createLucideIcon-B_nUUohf.js";import{C as u,a as p,b as v,d as f,c as g}from"./card-VBaD2IEJ.js";import{D as F}from"./data-table-AzOzFsuP.js";import{D as S,a as _,b as U,c as I,d as k,e as R}from"./dialog-CZVIs5lJ.js";import{I as L}from"./input-DzYQ5m_u.js";import{A as O}from"./app-layout-BGCKEgz0.js";import{H as Q,R as V}from"./refresh-ccw-CkjaJHrQ.js";import{M as J}from"./mail-BoblSyI4.js";import{U as X}from"./user-plus-Ha1trv5e.js";import{P as q}from"./plus-Dfw8G7Rp.js";import{S as G}from"./search-C3q3iw1y.js";import{X as W}from"./index-CLNw7G2W.js";import{E as Y}from"./eye-CzoNjkis.js";import{P as Z}from"./pencil-BGlMcnL_.js";import{T as ee}from"./trash-2-DUM6IXrt.js";import"./table-CJo_fE2T.js";import"./chevron-left-BWxIRoWk.js";import"./chevron-right-CGeDP67K.js";import"./index-Sf96LOB_.js";import"./index-BTWrQYXc.js";import"./index-BMyxxeHM.js";import"./index-CAOC8-7q.js";import"./breadcrumbs-dFN1_U_-.js";import"./app-logo-CmT7Dg9-.js";import"./index-zt1hKQbC.js";import"./index-DhGjvScC.js";import"./index-T_aLcDsz.js";import"./chevron-down-Ci-ChIoq.js";import"./file-text-UD7gAqkp.js";import"./trending-up-CXdbemyt.js";import"./target-DtZPjXpG.js";const se=[{title:"Dashboard",href:"/dashboard"},{title:"User Management",href:"/admin/users"}];function Ee({users:i,invitations:o,roles:A,filters:N}){var b;const{auth:j}=$().props,r=((b=j==null?void 0:j.user)==null?void 0:b.permissions)||[];console.log("User Permissions:",r);const[C,z]=x.useState(N.search||""),[y,T]=x.useState(N.role||""),[n,m]=x.useState(null),[l,h]=x.useState(null),E=s=>{s.preventDefault(),c.get("/admin/users",{search:C,role:y},{preserveState:!0,replace:!0})},K=s=>{c.delete(`/admin/users/${s.id}`,{onSuccess:()=>m(null)})},M=s=>{c.delete(`/admin/users/invitations/${s.id}`,{onSuccess:()=>h(null)})},H=s=>{c.post(`/admin/users/invitations/${s.id}/resend`)},P=[{header:"Name",accessorKey:"name",cell:s=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.email})]})},{header:"Roles",accessorKey:"roles",cell:s=>{var d;return e.jsx("div",{className:"flex flex-wrap gap-1",children:((d=s.roles)==null?void 0:d.map(D=>e.jsx(w,{variant:"secondary",children:D.name},D.id)))||e.jsx("span",{className:"text-muted-foreground",children:"No roles"})})}},{header:"Email Verified",accessorKey:"email_verified_at",cell:s=>e.jsx(w,{variant:s.email_verified_at?"default":"destructive",children:s.email_verified_at?"Verified":"Unverified"})},{header:"Created",accessorKey:"created_at",cell:s=>new Date(s.created_at).toLocaleDateString()},{header:"Actions",accessorKey:"id",cell:s=>r!=null&&r.includes("manage-users")?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(a,{asChild:!0,variant:"ghost",size:"sm",children:e.jsx(t,{href:`/admin/users/${s.id}`,children:e.jsx(Y,{className:"h-4 w-4"})})}),e.jsx(a,{asChild:!0,variant:"ghost",size:"sm",children:e.jsx(t,{href:`/admin/users/${s.id}/edit`,children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>m(s),className:"text-destructive hover:text-destructive",children:e.jsx(ee,{className:"h-4 w-4"})})]}):null}];return e.jsxs(O,{breadcrumbs:se,children:[e.jsx(B,{title:"User Management"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage users and their permissions"})]}),(r==null?void 0:r.includes("manage-users"))&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(a,{asChild:!0,variant:"outline",children:e.jsxs(t,{href:"/admin/users/invitation-history",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Invitation History"]})}),e.jsx(a,{asChild:!0,variant:"outline",children:e.jsxs(t,{href:"/admin/users/invite",children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Invite User"]})}),e.jsx(a,{asChild:!0,variant:"outline",children:e.jsxs(t,{href:"/admin/users/sso-pending",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Pending SSO Users"]})}),e.jsx(a,{asChild:!0,children:e.jsxs(t,{href:"/admin/users/create",children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Add User"]})})]})]}),e.jsxs(u,{children:[e.jsxs(p,{children:[e.jsx(v,{children:"Filters"}),e.jsx(f,{children:"Filter users by search term and role"})]}),e.jsx(g,{children:e.jsxs("form",{onSubmit:E,className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(L,{placeholder:"Search by name or email...",value:C,onChange:s=>z(s.target.value)})}),e.jsx("div",{className:"w-48",children:e.jsxs("select",{value:y,onChange:s=>T(s.target.value),className:"w-full rounded-md border border-input bg-background px-3 py-2",children:[e.jsx("option",{value:"",children:"All Roles"}),A.map(s=>e.jsx("option",{value:s.name,children:s.name},s.id))]})}),e.jsxs(a,{type:"submit",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Search"]})]})})]}),e.jsxs(u,{children:[e.jsxs(p,{children:[e.jsxs(v,{children:["Users (",i.total,")"]}),e.jsx(f,{children:"All users in the system"})]}),e.jsxs(g,{children:[e.jsx(F,{columns:P,data:i.data,searchKey:"name",searchPlaceholder:"Search users..."}),e.jsx("div",{className:"flex items-center justify-between space-x-2 py-4",children:e.jsxs("div",{className:"space-x-2",children:[i.prev_page_url&&e.jsx(a,{variant:"outline",size:"sm",onClick:()=>c.visit(i.prev_page_url),children:"Previous"}),i.next_page_url&&e.jsx(a,{variant:"outline",size:"sm",onClick:()=>c.visit(i.next_page_url),children:"Next"})]})})]})]}),o&&o.length>0&&(r==null?void 0:r.includes("manage-users"))&&e.jsxs(u,{children:[e.jsxs(p,{children:[e.jsxs(v,{children:["Pending Invitations (",o.length,")"]}),e.jsx(f,{children:"Users who have been invited but haven't accepted yet"})]}),e.jsx(g,{children:e.jsx("div",{className:"space-y-4",children:o.map(s=>{var d;return e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.email}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Role: ",s.role]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Invited by: ",(d=s.inviter)==null?void 0:d.name]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Expires: ",new Date(s.expires_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>H(s),title:"Resend invitation",children:e.jsx(V,{className:"h-4 w-4"})}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>h(s),className:"text-destructive hover:text-destructive",title:"Cancel invitation",children:e.jsx(W,{className:"h-4 w-4"})})]})]},s.id)})})})]})]}),e.jsx(S,{open:!!n,onOpenChange:()=>m(null),children:e.jsxs(_,{children:[e.jsxs(U,{children:[e.jsx(I,{children:"Delete User"}),e.jsxs(k,{children:["Are you sure you want to delete ",n==null?void 0:n.name,"? This action cannot be undone."]})]}),e.jsxs(R,{children:[e.jsx(a,{variant:"outline",onClick:()=>m(null),children:"Cancel"}),e.jsx(a,{variant:"destructive",onClick:()=>n&&K(n),children:"Delete"})]})]})}),e.jsx(S,{open:!!l,onOpenChange:()=>h(null),children:e.jsxs(_,{children:[e.jsxs(U,{children:[e.jsx(I,{children:"Cancel Invitation"}),e.jsxs(k,{children:["Are you sure you want to cancel the invitation for ",l==null?void 0:l.email,"? This action cannot be undone."]})]}),e.jsxs(R,{children:[e.jsx(a,{variant:"outline",onClick:()=>h(null),children:"Cancel"}),e.jsx(a,{variant:"destructive",onClick:()=>l&&M(l),children:"Cancel Invitation"})]})]})})]})}export{Ee as default};
