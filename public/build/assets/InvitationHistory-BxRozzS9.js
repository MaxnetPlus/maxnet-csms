import{J,r as u,j as e,Q as O,t as D,S as h}from"./app-Ct02SPqS.js";import{B as f}from"./badge-Co5a1Bgq.js";import{B as r}from"./createLucideIcon-_hu__2Zm.js";import{C as n,a as c,b as d,c as o,d as _}from"./card-CCG6Tz-L.js";import{D as q}from"./data-table-11yZMElb.js";import{D as G,a as W,b as X,c as Y,d as Z,e as ee}from"./dialog-w7GOOatN.js";import{I as se}from"./input-CsnwnHV3.js";import{S as A,a as I,b as k,c as R,d as x}from"./select-BQhgVxFA.js";import{A as te}from"./app-layout-BnzRu4s9.js";import{H as ae,R as H}from"./refresh-ccw-DJC5V0_3.js";import{A as re}from"./arrow-left-idYIQRrV.js";import{M as K}from"./mail-khOo8Ohe.js";import{U as le}from"./breadcrumbs-BQDwV_-u.js";import{C as T}from"./clock-BPrqkCqO.js";import{S as ie}from"./search-D6qZOkyj.js";import{T as B}from"./trash-2-K_M61fbS.js";import{U as ne}from"./user-2gnWEvgD.js";import{C as ce}from"./calendar-CRlxWopN.js";import"./table-UACo1mkz.js";import"./chevron-left-DG6cbwMe.js";import"./chevron-right-DrnitRZM.js";import"./index-DHUJ--yc.js";import"./index-BCvBiwKD.js";import"./index-jj74kwHj.js";import"./index-B8WYyssL.js";import"./index-BcBdkLzA.js";import"./index-kYJyEc4f.js";import"./index-DD0-SZBN.js";import"./index-DcQsAyWr.js";import"./chevron-down-BWteAm1R.js";import"./chevron-up-CMJIJi5y.js";import"./app-logo-CH_8fs4b.js";import"./file-text-BGskns63.js";import"./trending-up-CG-a-nw_.js";import"./target-CU7hcelH.js";import"./index-Cj33yIcJ.js";const de=[{title:"Dashboard",href:"/dashboard"},{title:"User Management",href:"/admin/users"},{title:"Invitation History",href:"/admin/users/invitation-history"}];function Oe({invitations:t,roles:E,filters:v}){var b;const{auth:g}=J().props,N=((b=g==null?void 0:g.user)==null?void 0:b.permissions)||[],[S,U]=u.useState(v.search||""),[w,z]=u.useState(v.status||"all"),[y,L]=u.useState(v.role||"all"),[i,m]=u.useState(null),M=s=>{s.preventDefault();const a={search:S};w!=="all"&&(a.status=w),y!=="all"&&(a.role=y),h.get("/admin/users/invitation-history",a,{preserveState:!0,replace:!0})},P=s=>{h.delete(`/admin/users/invitations/${s.id}`,{onSuccess:()=>m(null)})},C=s=>{h.post(`/admin/users/invitations/${s.id}/resend`)},F=s=>{const a=new Date,j=new Date(s.expires_at);return s.accepted_at?e.jsx(f,{variant:"default",children:"Accepted"}):j<a?e.jsx(f,{variant:"destructive",children:"Expired"}):e.jsx(f,{variant:"secondary",children:"Pending"})},V=s=>{const a=new Date;return new Date(s.expires_at)<a?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>C(s),title:"Resend invitation",children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>m(s),className:"text-destructive hover:text-destructive",title:"Delete invitation",children:e.jsx(B,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>C(s),title:"Resend invitation",children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx(r,{variant:"ghost",size:"sm",onClick:()=>m(s),className:"text-destructive hover:text-destructive",title:"Cancel invitation",children:e.jsx(B,{className:"h-4 w-4"})})]})},Q=[{header:"Email",accessorKey:"email",cell:s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.email})]})},{header:"Role",accessorKey:"role",cell:s=>e.jsx(f,{variant:"outline",children:s.role})},{header:"Invited By",accessorKey:"inviter",cell:s=>{var a;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:((a=s.inviter)==null?void 0:a.name)||"Unknown"})]})}},{header:"Status",accessorKey:"accepted_at",cell:s=>F(s)},{header:"Created",accessorKey:"created_at",cell:s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:new Date(s.created_at).toLocaleDateString()})]})},{header:"Expires",accessorKey:"expires_at",cell:s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:new Date(s.expires_at).toLocaleDateString()})]})},{header:"Actions",accessorKey:"id",cell:s=>V(s)}],p=(()=>{const s=t.total,a=t.data.filter(l=>!l.accepted_at&&new Date(l.expires_at)>new Date).length,j=t.data.filter(l=>l.accepted_at).length,$=t.data.filter(l=>!l.accepted_at&&new Date(l.expires_at)<=new Date).length;return{total:s,pending:a,accepted:j,expired:$}})();return e.jsxs(te,{breadcrumbs:de,children:[e.jsx(O,{title:"Invitation History"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"flex items-center gap-2 text-3xl font-bold",children:[e.jsx(ae,{className:"h-8 w-8"}),"Invitation History"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and track all user invitations"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{asChild:!0,variant:"outline",children:e.jsxs(D,{href:"/admin/users",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Back to Users"]})}),(N==null?void 0:N.includes("manage-users"))&&e.jsx(r,{asChild:!0,children:e.jsxs(D,{href:"/admin/users/invite",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Send Invitation"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Total Invitations"}),e.jsx(le,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:p.total})})]}),e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Pending"}),e.jsx(T,{className:"h-4 w-4 text-yellow-600"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:p.pending})})]}),e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Accepted"}),e.jsx("div",{className:"h-4 w-4 rounded-full bg-green-600"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.accepted})})]}),e.jsxs(n,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Expired"}),e.jsx("div",{className:"h-4 w-4 rounded-full bg-red-600"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:p.expired})})]})]}),e.jsxs(n,{children:[e.jsxs(c,{children:[e.jsx(d,{children:"Filters"}),e.jsx(_,{children:"Filter invitations by search term, status, and role"})]}),e.jsx(o,{children:e.jsxs("form",{onSubmit:M,className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(se,{placeholder:"Search by email or inviter name...",value:S,onChange:s=>U(s.target.value)})}),e.jsx("div",{className:"w-48",children:e.jsxs(A,{value:w,onValueChange:z,children:[e.jsx(I,{children:e.jsx(k,{placeholder:"All Status"})}),e.jsxs(R,{children:[e.jsx(x,{value:"all",children:"All Status"}),e.jsx(x,{value:"pending",children:"Pending"}),e.jsx(x,{value:"accepted",children:"Accepted"}),e.jsx(x,{value:"expired",children:"Expired"})]})]})}),e.jsx("div",{className:"w-48",children:e.jsxs(A,{value:y,onValueChange:L,children:[e.jsx(I,{children:e.jsx(k,{placeholder:"All Roles"})}),e.jsxs(R,{children:[e.jsx(x,{value:"all",children:"All Roles"}),E.map(s=>e.jsx(x,{value:s.name,children:s.name},s.id))]})]})}),e.jsxs(r,{type:"submit",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Search"]})]})})]}),e.jsxs(n,{children:[e.jsxs(c,{children:[e.jsxs(d,{children:["All Invitations (",t.total,")"]}),e.jsx(_,{children:"Complete history of all user invitations"})]}),e.jsxs(o,{children:[e.jsx(q,{columns:Q,data:t.data,searchKey:"email",searchPlaceholder:"Search invitations..."}),e.jsxs("div",{className:"flex items-center justify-between space-x-2 py-4",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",t.from," to ",t.to," of ",t.total," invitations"]})}),e.jsxs("div",{className:"space-x-2",children:[t.prev_page_url&&e.jsx(r,{variant:"outline",size:"sm",onClick:()=>h.visit(t.prev_page_url),children:"Previous"}),t.next_page_url&&e.jsx(r,{variant:"outline",size:"sm",onClick:()=>h.visit(t.next_page_url),children:"Next"})]})]})]})]})]}),e.jsx(G,{open:!!i,onOpenChange:()=>m(null),children:e.jsxs(W,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Delete Invitation"}),e.jsxs(Z,{children:["Are you sure you want to delete the invitation for ",i==null?void 0:i.email,"? This action cannot be undone."]})]}),e.jsxs(ee,{children:[e.jsx(r,{variant:"outline",onClick:()=>m(null),children:"Cancel"}),e.jsx(r,{variant:"destructive",onClick:()=>i&&P(i),children:"Delete Invitation"})]})]})})]})}export{Oe as default};
