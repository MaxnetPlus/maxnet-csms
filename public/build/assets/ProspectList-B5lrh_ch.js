import{r as c,j as e,t as R,S as q}from"./app-1TQRmdbV.js";import{B}from"./badge-CzRULw-a.js";import{B as i,c as P}from"./createLucideIcon-DWwUjqXg.js";import{C as H,a as O,b as ie,d as ne,c as X}from"./card-BAct_2yV.js";import{I as T}from"./input-MMDH--PJ.js";import{u as ce,N as de}from"./notification-BRqN__eB.js";import{S as N,a as v,b,c as w,d as n}from"./select-BAoByakW.js";import{F as oe}from"./filter-BvU37wBx.js";import{S as me}from"./search-DAVgrURI.js";import{L as U}from"./loader-circle-BCbXz62b.js";import{X as he}from"./index-DSPG1tRr.js";import{C as ue}from"./chevron-left-CHkmRqMs.js";import{C as xe}from"./chevron-right-BlqDddEB.js";import{C as $}from"./circle-check-big-CYbVYbLW.js";import{E as pe}from"./eye-DYnv7MDb.js";import{C as je}from"./circle-x-Bv0EzrVZ.js";import{T as ge}from"./trash-2-DIWugmls.js";import"./alert-BEhanTJV.js";import"./triangle-alert-BbECeSQw.js";import"./index-DrblBIbr.js";import"./index-DVN2uUiL.js";import"./index-BN0-t6CM.js";import"./index-CKKK69Ka.js";import"./chevron-down-DygrjMWq.js";import"./chevron-up-Cfwtt-4t.js";const fe={new:{label:"New",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"},contacted:{label:"Contacted",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"},qualified:{label:"Qualified",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"},converted:{label:"Converted",className:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300"},rejected:{label:"Rejected",className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}};function Xe({initialFilters:m={},categories:z,salesUsers:J}){const C=()=>new Date().toISOString().split("T")[0];console.log("categories",z);const[a,K]=c.useState(null),[h,A]=c.useState(!1),{notification:g,showNotification:p,hideNotification:Q}=ce(),[r,u]=c.useState({search:m.search||"",status:m.status||"all",category_id:m.category_id||"all",sales_id:m.sales_id||"all",date_from:m.date_from||C(),date_to:m.date_to||C(),sort:m.sort||"created_at",direction:m.direction||"desc"}),[o,E]=c.useState(1),[f,W]=c.useState(15),[y,G]=c.useState(!1),[L,Y]=c.useState(""),Z=(s,t)=>{let l;return(...d)=>{clearTimeout(l),l=setTimeout(()=>s(...d),t)}},x=c.useCallback(async(s=1,t=r,l=!1)=>{var M;const d={page:s,per_page:f,...t},V=JSON.stringify(d);if(!(!l&&V===L)){A(!0),Y(V);try{const _=((M=document.querySelector('meta[name="csrf-token"]'))==null?void 0:M.getAttribute("content"))||"",k=await fetch(route("admin.prospect-management.table-data"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":_,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:JSON.stringify(d)});if(!k.ok)throw new Error(`HTTP error! Status: ${k.status}`);const I=await k.json();K(I),E(I.current_page)}catch(_){console.error("Failed to fetch data:",_),p("error","Data Fetch Error","Failed to load prospect data. Please try again.")}finally{A(!1)}}},[f,L]),ee=c.useCallback(Z((s,t)=>{x(s,t,!0)},300),[]);c.useEffect(()=>{x(1,r,!0)},[]),c.useEffect(()=>{a&&x(1,r,!0)},[f]),c.useEffect(()=>{a&&ee(1,r)},[r]);const se=s=>{s.preventDefault()},j=s=>{s>=1&&s<=((a==null?void 0:a.last_page)||1)&&x(s,r,!0)},te=s=>{const t=r.sort===s&&r.direction==="asc"?"desc":"asc";u(l=>({...l,sort:s,direction:t}))},ae=()=>{const s=C(),t={search:"",status:"all",category_id:"all",sales_id:"all",date_from:s,date_to:s,sort:"created_at",direction:"desc"};u(t),E(1),x(1,t,!0)},re=async s=>{confirm("Are you sure you want to delete this prospect? This action cannot be undone.")&&q.delete(route("admin.prospect-management.destroy",s),{onSuccess:()=>{x(o,r,!0),p("success","Prospect Deleted","The prospect has been successfully deleted.")},onError:t=>{console.error("Error deleting prospect:",t),p("error","Delete Failed","An error occurred while deleting the prospect.")}})},F=(s,t)=>{confirm(`Are you sure you want to ${t==="approved"?"approve":"reject"} this prospect?`)&&q.patch(route("admin.prospect-management.update-status",s),{status:t==="approved"?"qualified":"rejected"},{onSuccess:()=>{x(o,r,!0),p("success","Status Updated",`Prospect has been ${t==="approved"?"approved":"rejected"} successfully.`)},onError:l=>{console.error("Error updating status:",l),p("error","Update Failed","An error occurred while updating the prospect status.")}})},D=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),le=({field:s})=>r.sort!==s?e.jsx("span",{className:"text-gray-400",children:"↕"}):r.direction==="asc"?e.jsx("span",{children:"↑"}):e.jsx("span",{children:"↓"}),S=[{header:"ID",className:"min-w-[80px]",sortable:!0,render:s=>e.jsxs("div",{className:"font-medium",children:["#",s.id]})},{header:"Customer",className:"min-w-[200px]",sortable:!0,render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customer_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.customer_email}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["📱 ",s.customer_number]})]})},{header:"Address",className:"min-w-[180px]",render:s=>e.jsxs("div",{className:"max-w-[180px] space-y-1 text-sm",children:[s.address&&e.jsxs("div",{className:"truncate",title:s.address,children:["👤 ",s.address]}),s.sales_location&&e.jsxs("div",{className:"truncate text-muted-foreground",title:s.sales_location,children:["👨‍💼 ",s.sales_location]}),s.latitude&&s.longitude&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["📍 ",Number(s.latitude).toFixed(6),", ",Number(s.longitude).toFixed(6)]})]})},{header:"Sales",className:"min-w-[120px]",sortable:!0,render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.sales.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["@",s.sales.username]})]})},{header:"Category",className:"min-w-[120px]",render:s=>e.jsxs("div",{children:[e.jsx(B,{variant:"outline",children:s.category.name}),e.jsxs("div",{className:"mt-1 text-sm font-medium text-primary",children:["+",s.points||s.category.points," points"]})]})},{header:"Status",className:"min-w-[120px]",sortable:!0,render:s=>{const t=fe[s.status];return e.jsx(B,{className:t==null?void 0:t.className,children:t==null?void 0:t.label})}},{header:"Created",className:"min-w-[140px]",sortable:!0,render:s=>e.jsx("div",{className:"text-sm",children:D(s.created_at)})},{header:"Converted",className:"min-w-[140px]",render:s=>e.jsx("div",{className:"text-sm",children:s.converted_at?e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx($,{className:"h-3 w-3"}),D(s.converted_at)]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})})},{header:"Actions",className:"min-w-[200px]",render:s=>e.jsxs("div",{className:"flex gap-1",children:[e.jsx(R,{href:route("admin.prospect-management.show",s.id),children:e.jsx(i,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",title:"View Details",children:e.jsx(pe,{className:"h-4 w-4"})})}),s.status==="new"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{size:"sm",variant:"outline",className:"h-8 px-2 text-green-600 hover:bg-green-50",title:"Approve Prospect",onClick:()=>F(s.id,"approved"),children:e.jsx($,{className:"h-4 w-4"})}),e.jsx(i,{size:"sm",variant:"outline",className:"h-8 px-2 text-red-600 hover:bg-red-50",title:"Reject Prospect",onClick:()=>F(s.id,"rejected"),children:e.jsx(je,{className:"h-4 w-4"})})]}),e.jsx(i,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50 hover:text-red-700",title:"Delete Prospect",onClick:()=>re(s.id),children:e.jsx(ge,{className:"h-4 w-4"})})]})}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx(de,{show:g.show,type:g.type,title:g.title,message:g.message,onClose:Q,autoHide:!0,duration:5e3,position:"top-right"}),e.jsxs(H,{children:[e.jsxs(O,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ie,{children:"Prospect Management"}),e.jsx(ne,{children:"Manage and track customer prospects"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>G(!y),className:P("gap-2",y&&"bg-muted"),children:[e.jsx(oe,{className:"h-4 w-4"}),"Filters"]})})]}),e.jsxs("form",{onSubmit:se,className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(me,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(T,{placeholder:"Search by customer name, email, phone, or address...",value:r.search,onChange:s=>u(t=>({...t,search:s.target.value})),className:"pl-9"})]}),e.jsx(i,{type:"submit",size:"sm",disabled:h,children:h?e.jsx(U,{className:"h-4 w-4 animate-spin"}):"Search"}),(r.search||r.status!=="all"||r.category_id!=="all"||r.sales_id!=="all"||r.date_from||r.date_to)&&e.jsxs(i,{type:"button",variant:"outline",size:"sm",onClick:ae,children:[e.jsx(he,{className:"h-4 w-4"}),"Clear"]})]})]}),e.jsx(X,{className:"space-y-4",children:y&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 pt-4 md:grid-cols-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(N,{value:r.status,onValueChange:s=>u(t=>({...t,status:s})),children:[e.jsx(v,{children:e.jsx(b,{placeholder:"All Status"})}),e.jsxs(w,{children:[e.jsx(n,{value:"all",children:"All Status"}),e.jsx(n,{value:"new",children:"New"}),e.jsx(n,{value:"contacted",children:"Contacted"}),e.jsx(n,{value:"qualified",children:"Qualified"}),e.jsx(n,{value:"converted",children:"Converted"}),e.jsx(n,{value:"rejected",children:"Rejected"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Category"}),e.jsxs(N,{value:r.category_id,onValueChange:s=>u(t=>({...t,category_id:s})),children:[e.jsx(v,{children:e.jsx(b,{placeholder:"All Categories"})}),e.jsxs(w,{children:[e.jsx(n,{value:"all",children:"All Categories"}),z.map(s=>e.jsxs(n,{value:s.id.toString(),children:[s.name," (",s.points," pts)"]},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Sales Person"}),e.jsxs(N,{value:r.sales_id,onValueChange:s=>u(t=>({...t,sales_id:s})),children:[e.jsx(v,{children:e.jsx(b,{placeholder:"All Sales"})}),e.jsxs(w,{children:[e.jsx(n,{value:"all",children:"All Sales"}),J.map(s=>e.jsx(n,{value:s.id.toString(),children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:s.name})})},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Date From"}),e.jsx(T,{type:"date",value:r.date_from,onChange:s=>u(t=>({...t,date_from:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Date To"}),e.jsx(T,{type:"date",value:r.date_to,onChange:s=>u(t=>({...t,date_to:s.target.value}))})]})]})})]}),e.jsxs(H,{children:[e.jsx(O,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",(a==null?void 0:a.from)||0," to ",(a==null?void 0:a.to)||0," of ",(a==null?void 0:a.total)||0," entries"]}),e.jsxs(N,{value:f.toString(),onValueChange:s=>W(parseInt(s)),children:[e.jsx(v,{className:"w-20",children:e.jsx(b,{})}),e.jsxs(w,{children:[e.jsx(n,{value:"15",children:"15"}),e.jsx(n,{value:"25",children:"25"}),e.jsx(n,{value:"50",children:"50"}),e.jsx(n,{value:"100",children:"100"})]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(R,{href:route("admin.prospect-management.export"),className:"inline-flex items-center",children:e.jsxs(i,{variant:"outline",size:"sm",className:"gap-1",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-file-earmark-excel",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M5.884 6.68a.5.5 0 1 0-.768.64L7.349 10l-2.233 2.68a.5.5 0 0 0 .768.64L8 10.781l2.116 2.54a.5.5 0 0 0 .768-.641L8.651 10l2.233-2.68a.5.5 0 0 0-.768-.64L8 9.219l-2.116-2.54z"}),e.jsx("path",{d:"M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"})]}),"Export CSV"]})})})]})}),e.jsx(X,{className:"p-0",children:e.jsxs("div",{className:"relative",children:[h&&e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-background/50",children:e.jsx(U,{className:"h-8 w-8 animate-spin"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b",children:S.map((s,t)=>e.jsx("th",{className:P("p-3 text-left font-medium",s.className,s.sortable&&"cursor-pointer hover:bg-muted/50"),onClick:()=>s.sortable&&te(s.header.toLowerCase().replace(" ","_")),children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.header,s.sortable&&e.jsx(le,{field:s.header.toLowerCase().replace(" ","_")})]})},t))})}),e.jsxs("tbody",{children:[a==null?void 0:a.data.map(s=>e.jsx("tr",{className:"border-b hover:bg-muted/50",children:S.map((t,l)=>e.jsx("td",{className:P("p-3",t.className),children:t.render(s)},l))},s.id)),(a==null?void 0:a.data.length)===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:S.length,className:"p-8 text-center text-muted-foreground",children:"No prospects found matching your criteria."})})]})]})})]})})]}),a&&a.last_page>1&&e.jsxs("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-2 rounded-lg border bg-card p-4 text-card-foreground shadow",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",e.jsx("span",{className:"font-medium text-foreground",children:a.from})," to"," ",e.jsx("span",{className:"font-medium text-foreground",children:a.to})," of"," ",e.jsx("span",{className:"font-medium text-foreground",children:a.total})," prospects"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>j(o-1),disabled:o<=1||h,children:[e.jsx(ue,{className:"mr-1 h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"hidden gap-1 sm:flex",children:(()=>{const s=[];let t=Math.max(1,o-2),l=Math.min(t+4,a.last_page);l-t<4&&(t=Math.max(1,l-4)),t>1&&(s.push(e.jsx(i,{variant:o===1?"default":"outline",size:"sm",onClick:()=>j(1),disabled:h,className:"h-8 w-8 p-0",children:"1"},1)),t>2&&s.push(e.jsx(i,{variant:"outline",size:"sm",disabled:!0,className:"h-8 w-8 p-0",children:"..."},"ellipsis1")));for(let d=t;d<=l;d++)s.push(e.jsx(i,{variant:d===o?"default":"outline",size:"sm",onClick:()=>j(d),disabled:h,className:"h-8 w-8 p-0",children:d},d));return l<a.last_page&&(l<a.last_page-1&&s.push(e.jsx(i,{variant:"outline",size:"sm",disabled:!0,className:"h-8 w-8 p-0",children:"..."},"ellipsis2")),s.push(e.jsx(i,{variant:a.last_page===o?"default":"outline",size:"sm",onClick:()=>j(a.last_page),disabled:h,className:"h-8 w-8 p-0",children:a.last_page},a.last_page))),s})()}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>j(o+1),disabled:o>=a.last_page||h,children:["Next",e.jsx(xe,{className:"ml-1 h-4 w-4"})]})]})]})]})}export{Xe as default};
