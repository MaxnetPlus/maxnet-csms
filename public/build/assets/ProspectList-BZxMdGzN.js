import{r as c,j as e,t as Y,S as E}from"./app-BLez37KC.js";import{B as $}from"./badge-D4xRpmmj.js";import{B as i}from"./createLucideIcon-D7jF-U3a.js";import{C as D,a as L,b as z,c as I}from"./card-DPL22DDR.js";import{I as Z}from"./input-CfqiYqKE.js";import{S as j,a as g,b as f,c as N,d as n}from"./select-DacCT32A.js";import{F as ee}from"./filter-0e3Il8QG.js";import{S as se}from"./search-5A-tRwWL.js";import{C as te}from"./chevron-left-Bxm-WpsQ.js";import{C as ae}from"./chevron-right-Ci9N-8KN.js";import{C as R}from"./circle-check-big-BqYYaXAB.js";import{E as re}from"./eye-Dw8C-THZ.js";import{C as le}from"./circle-x-K7WxpJxN.js";import{T as ne}from"./trash-2-wKVmLTrg.js";import"./index-CUGJ33FR.js";import"./index-DACyNOe1.js";import"./index-BM8vqouP.js";import"./index-C8WjSdCF.js";import"./index-DCLdOoa8.js";import"./index-CudrPBro.js";import"./chevron-down-Owv8Hoe3.js";const ce={new:{label:"New",className:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300"},contacted:{label:"Contacted",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"},qualified:{label:"Qualified",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"},converted:{label:"Converted",className:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300"},rejected:{label:"Rejected",className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"}};function Pe({initialFilters:d={},categories:V,salesUsers:q}){const[a,B]=c.useState(null),[m,w]=c.useState(!1),[r,h]=c.useState({search:d.search||"",status:d.status||"all",category_id:d.category_id||"all",sales_id:d.sales_id||"all",date_from:d.date_from||"",date_to:d.date_to||"",sort:d.sort||"created_at",direction:d.direction||"desc"}),[o,S]=c.useState(1),[u,O]=c.useState(15),[v,M]=c.useState(!1),[y,H]=c.useState(""),J=(s,t)=>{let l;return(...p)=>{clearTimeout(l),l=setTimeout(()=>s(...p),t)}},x=c.useCallback(async(s=1,t=r,l=!1)=>{var P;const p={page:s,per_page:u,...t},A=JSON.stringify(p);if(!(!l&&A===y)){w(!0),H(A);try{const F=await(await fetch("/admin/prospect-management/table-data",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((P=document.querySelector('meta[name="csrf-token"]'))==null?void 0:P.getAttribute("content"))||""},body:JSON.stringify(p)})).json();B(F),S(F.current_page)}catch(T){console.error("Failed to fetch data:",T)}finally{w(!1)}}},[u,y]),K=c.useCallback(J((s,t)=>{x(s,t,!0)},300),[]);c.useEffect(()=>{x(1,r,!0)},[]),c.useEffect(()=>{a&&x(1,r,!0)},[u]),c.useEffect(()=>{a&&K(1,r)},[r]);const Q=s=>{s.preventDefault()},b=s=>{s>=1&&s<=((a==null?void 0:a.last_page)||1)&&x(s,r,!0)},X=s=>{const t=r.sort===s&&r.direction==="asc"?"desc":"asc";h(l=>({...l,sort:s,direction:t}))},U=()=>{h({search:"",status:"all",category_id:"all",sales_id:"all",date_from:"",date_to:"",sort:"created_at",direction:"desc"}),S(1)},G=async s=>{confirm("Are you sure you want to delete this prospect? This action cannot be undone.")&&E.delete(`/admin/prospect-management/${s}`,{onSuccess:()=>{x(o,r,!0)},onError:t=>{console.error("Error deleting prospect:",t),alert("An error occurred while deleting the prospect.")}})},_=(s,t)=>{confirm(`Are you sure you want to ${t==="approved"?"approve":"reject"} this prospect?`)&&E.patch(`/admin/prospect-management/${s}/status`,{status:t==="approved"?"qualified":"rejected"},{onSuccess:()=>{x(o,r,!0)}})},k=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),W=({field:s})=>r.sort!==s?e.jsx("span",{className:"text-gray-400",children:"↕"}):r.direction==="asc"?e.jsx("span",{children:"↑"}):e.jsx("span",{children:"↓"}),C=[{header:"ID",className:"min-w-[80px]",sortable:!0,render:s=>e.jsxs("div",{className:"font-medium",children:["#",s.id]})},{header:"Customer",className:"min-w-[200px]",sortable:!0,render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customer_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.customer_email}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["📱 ",s.customer_number]})]})},{header:"Address",className:"min-w-[180px]",render:s=>e.jsxs("div",{className:"max-w-[180px] text-sm space-y-1",children:[s.address&&e.jsxs("div",{className:"truncate",title:s.address,children:["👤 ",s.address]}),s.sales_location&&e.jsxs("div",{className:"truncate text-muted-foreground",title:s.sales_location,children:["👨‍💼 ",s.sales_location]}),s.latitude&&s.longitude&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["📍 ",Number(s.latitude).toFixed(6),", ",Number(s.longitude).toFixed(6)]})]})},{header:"Sales",className:"min-w-[120px]",sortable:!0,render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.sales.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["@",s.sales.username]})]})},{header:"Category",className:"min-w-[120px]",render:s=>e.jsxs("div",{children:[e.jsx($,{variant:"outline",children:s.category.name}),e.jsxs("div",{className:"mt-1 text-sm font-medium text-primary",children:["+",s.points||s.category.points," points"]})]})},{header:"Status",className:"min-w-[120px]",sortable:!0,render:s=>{const t=ce[s.status];return e.jsx($,{className:t==null?void 0:t.className,children:t==null?void 0:t.label})}},{header:"Created",className:"min-w-[140px]",sortable:!0,render:s=>e.jsx("div",{className:"text-sm",children:k(s.created_at)})},{header:"Converted",className:"min-w-[140px]",render:s=>e.jsx("div",{className:"text-sm",children:s.converted_at?e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(R,{className:"h-3 w-3"}),k(s.converted_at)]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})})},{header:"Actions",className:"min-w-[200px]",render:s=>e.jsxs("div",{className:"flex gap-1",children:[e.jsx(Y,{href:`/admin/prospect-management/${s.id}`,children:e.jsx(i,{size:"sm",variant:"outline",className:"h-8 w-8 p-0",title:"View Details",children:e.jsx(re,{className:"h-4 w-4"})})}),s.status==="new"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{size:"sm",variant:"outline",className:"h-8 px-2 text-green-600 hover:bg-green-50",title:"Approve Prospect",onClick:()=>_(s.id,"approved"),children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(i,{size:"sm",variant:"outline",className:"h-8 px-2 text-red-600 hover:bg-red-50",title:"Reject Prospect",onClick:()=>_(s.id,"rejected"),children:e.jsx(le,{className:"h-4 w-4"})})]}),e.jsx(i,{size:"sm",variant:"outline",className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50 hover:text-red-700",title:"Delete Prospect",onClick:()=>G(s.id),children:e.jsx(ne,{className:"h-4 w-4"})})]})}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(D,{children:[e.jsx(L,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Filters & Search"]}),e.jsx(i,{variant:"outline",onClick:()=>M(!v),children:v?"Hide Filters":"Show Filters"})]})}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("form",{onSubmit:Q,className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(se,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 transform text-muted-foreground"}),e.jsx(Z,{placeholder:"Search by customer name, email, phone, or address...",value:r.search,onChange:s=>h(t=>({...t,search:s.target.value})),className:"pl-10"})]}),e.jsx(i,{type:"submit",variant:"outline",disabled:m,children:"Search"}),e.jsx(i,{type:"button",variant:"outline",onClick:U,disabled:m,children:"Clear"})]}),v&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(j,{value:r.status,onValueChange:s=>h(t=>({...t,status:s})),children:[e.jsx(g,{children:e.jsx(f,{placeholder:"All Status"})}),e.jsxs(N,{children:[e.jsx(n,{value:"all",children:"All Status"}),e.jsx(n,{value:"new",children:"New"}),e.jsx(n,{value:"contacted",children:"Contacted"}),e.jsx(n,{value:"qualified",children:"Qualified"}),e.jsx(n,{value:"converted",children:"Converted"}),e.jsx(n,{value:"rejected",children:"Rejected"})]})]}),e.jsxs(j,{value:r.category_id,onValueChange:s=>h(t=>({...t,category_id:s})),children:[e.jsx(g,{children:e.jsx(f,{placeholder:"All Categories"})}),e.jsxs(N,{children:[e.jsx(n,{value:"all",children:"All Categories"}),V.map(s=>e.jsxs(n,{value:s.id.toString(),children:[s.name," (",s.points," pts)"]},s.id))]})]}),e.jsxs(j,{value:r.sales_id,onValueChange:s=>h(t=>({...t,sales_id:s})),children:[e.jsx(g,{children:e.jsx(f,{placeholder:"All Sales"})}),e.jsxs(N,{children:[e.jsx(n,{value:"all",children:"All Sales"}),q.map(s=>e.jsx(n,{value:s.id.toString(),children:s.name},s.id))]})]}),e.jsxs(j,{value:u.toString(),onValueChange:s=>O(Number(s)),children:[e.jsx(g,{children:e.jsx(f,{})}),e.jsxs(N,{children:[e.jsx(n,{value:"10",children:"10 per page"}),e.jsx(n,{value:"15",children:"15 per page"}),e.jsx(n,{value:"25",children:"25 per page"}),e.jsx(n,{value:"50",children:"50 per page"})]})]})]})]})]}),e.jsxs(D,{children:[e.jsx(L,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(z,{children:["Prospects ",a&&`(${a.from}-${a.to} of ${a.total})`]}),m&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading..."})]})}),e.jsx(I,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b",children:C.map((s,t)=>e.jsx("th",{className:`p-3 text-left text-sm font-medium ${s.className||""}`,children:s.sortable?e.jsxs("button",{onClick:()=>X(s.header.toLowerCase().replace(" ","_")),className:"flex items-center gap-1 hover:text-primary",disabled:m,children:[s.header,e.jsx(W,{field:s.header.toLowerCase().replace(" ","_")})]}):s.header},t))})}),e.jsxs("tbody",{children:[a==null?void 0:a.data.map(s=>e.jsx("tr",{className:"border-b hover:bg-muted/50",children:C.map((t,l)=>e.jsx("td",{className:`p-3 ${t.className||""}`,children:t.render(s)},l))},s.id)),(a==null?void 0:a.data.length)===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:C.length,className:"p-8 text-center text-muted-foreground",children:"No prospects found matching your criteria."})})]})]})})})]}),a&&a.last_page>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>b(o-1),disabled:o<=1||m,children:[e.jsx(te,{className:"h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,a.last_page)},(s,t)=>{const l=Math.max(1,Math.min(a.last_page-4,o-2))+t;return l<=a.last_page?e.jsx(i,{variant:l===o?"default":"outline",size:"sm",onClick:()=>b(l),disabled:m,className:"h-8 w-8 p-0",children:l},l):null})}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>b(o+1),disabled:o>=a.last_page||m,children:["Next",e.jsx(ae,{className:"h-4 w-4"})]})]})]})}export{Pe as default};
