import{r as n,j as e,t as q}from"./app-BYRtyPb_.js";import{B as F}from"./badge-BC2Zd0d0.js";import{c as H,B as m,a as D}from"./createLucideIcon-BpiIJ4rm.js";import{C as J,a as K,b as X,d as Q,c as W}from"./card-BftSBUJ8.js";import{I as v}from"./input-Coj9-rY9.js";import{S as A,a as E,b as L,c as T,d as x}from"./select-ClEhQcuI.js";import{L as _}from"./loader-circle-TYb9LPnn.js";import{S as Y}from"./search-BKK2UEjZ.js";import{X as Z}from"./index-le9HfdOu.js";import{C as ee}from"./chevron-left-BMRaTl8q.js";import{C as se}from"./chevron-right-Dwz8_c5V.js";import{E as te}from"./eye-4WkWLZPN.js";import"./index-D7g51E5Q.js";import"./index-BF6Sw6ge.js";import"./index-Ci58ZKDv.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]],re=H("Filter",ae),le={ACTIVE:{label:"Active",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"},CANCELED:{label:"Canceled",className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"},SUSPEND:{label:"Suspended",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"},DISMANTLE:{label:"Dismantled",className:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}};function ve({initialFilters:c={},groups:I}){const[r,P]=n.useState(null),[u,S]=n.useState(!1),[a,i]=n.useState({search:c.search||"",status:c.status||"",group:c.group||"",date_from:c.date_from||"",date_to:c.date_to||"",sort:c.sort||"created_at",direction:c.direction||"desc"}),[d,o]=n.useState(1),[p,$]=n.useState(15),[f,z]=n.useState(!1),[C,V]=n.useState(""),B=(s,t)=>{let l;return(...h)=>{clearTimeout(l),l=setTimeout(()=>s(...h),t)}},j=n.useCallback(async(s=1,t=a,l=!1)=>{var k;const h=JSON.stringify({page:s,currentFilters:t,perPage:p});if(!(!l&&h===C)){S(!0);try{const N=await fetch("/admin/subscriptions/table-data",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((k=document.querySelector('meta[name="csrf-token"]'))==null?void 0:k.getAttribute("content"))||""},body:JSON.stringify({page:s,per_page:p,...t})});if(N.ok){const g=await N.json();P(g),V(h),g.current_page!==d&&o(g.current_page)}}catch(N){console.error("Error fetching table data:",N)}finally{S(!1)}}},[p,C,d]),G=n.useCallback(B((s,t)=>{j(s,t,!0)},300),[]);n.useEffect(()=>{j(1,a,!0),o(1)},[]),n.useEffect(()=>{r&&(j(1,a,!0),o(1))},[p]),n.useEffect(()=>{(a.search!==c.search||a.status!==c.status||a.group!==c.group||a.date_from!==c.date_from||a.date_to!==c.date_to||a.sort!==c.sort||a.direction!==c.direction)&&r&&(G(1,a),o(1))},[a]);const O=s=>{s.preventDefault(),j(1,a,!0),o(1)},b=s=>{s>=1&&s<=((r==null?void 0:r.last_page)||1)&&s!==d&&(o(s),j(s,a,!0))},M=s=>{const t=a.sort===s&&a.direction==="asc"?"desc":"asc",l={...a,sort:s,direction:t};i(l),o(1)},R=()=>{i({search:"",status:"",group:"",date_from:"",date_to:"",sort:"created_at",direction:"desc"}),o(1)},w=s=>new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}),U=({field:s})=>a.sort!==s?e.jsx("span",{className:"h-4 w-4"}):a.direction==="asc"?e.jsx("span",{className:"text-xs",children:"↑"}):e.jsx("span",{className:"text-xs",children:"↓"}),y=[{header:"Subscription ID",className:"min-w-[140px]",sortable:!0,render:s=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.subscription_id}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Service: ",s.serv_id]})]})},{header:"Customer",className:"min-w-[180px]",sortable:!0,render:s=>{var t,l;return e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:((t=s.customer)==null?void 0:t.customer_name)||"N/A"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.customer_id}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(l=s.customer)==null?void 0:l.customer_phone})]})}},{header:"Address",className:"min-w-[200px]",render:s=>e.jsx("div",{className:"max-w-[200px]",children:e.jsx("p",{className:"truncate text-sm",title:s.subscription_address,children:s.subscription_address||"N/A"})})},{header:"Status",className:"min-w-[100px]",sortable:!0,render:s=>{const t=le[s.subscription_status];return e.jsx(F,{className:D("text-xs",t==null?void 0:t.className),children:(t==null?void 0:t.label)||s.subscription_status})}},{header:"Group",className:"min-w-[80px]",sortable:!0,render:s=>e.jsx("span",{className:"text-sm",children:s.group||"N/A"})},{header:"Description",className:"min-w-[200px]",render:s=>e.jsx("div",{className:"max-w-[200px]",children:e.jsx("p",{className:"truncate text-sm",title:s.subscription_description||"No description",children:s.subscription_description||"No description"})})},{header:"Start Date",className:"min-w-[120px]",sortable:!0,render:s=>e.jsx("span",{className:"text-sm",children:s.subscription_start_date?w(s.subscription_start_date):"N/A"})},{header:"Updated At",className:"min-w-[120px]",sortable:!0,render:s=>e.jsx("span",{className:"text-sm",children:s.updated_at?w(s.updated_at):"N/A"})},{header:"Actions",className:"min-w-[100px]",render:s=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(m,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(q,{href:`/admin/subscriptions/${s.subscription_id}`,children:e.jsx(te,{className:"h-4 w-4"})})})})}];return e.jsxs(J,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(X,{className:"flex items-center gap-2",children:["Subscriptions Data",u&&e.jsx(_,{className:"h-4 w-4 animate-spin"})]}),e.jsx(Q,{children:r&&`Showing ${r.from}-${r.to} of ${r.total} records`})]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>z(!f),children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),f?"Hide":"Show"," Filters"]})]})}),e.jsxs(W,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("form",{onSubmit:O,className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(v,{placeholder:"Search by ID, Service ID, Address, Customer Name...",value:a.search,onChange:s=>i(t=>({...t,search:s.target.value}))})}),e.jsxs(m,{type:"submit",disabled:u,children:[u?e.jsx(_,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Search"]}),(a.search||a.status||a.group||a.date_from||a.date_to)&&e.jsxs(m,{type:"button",variant:"outline",onClick:R,children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Clear"]})]}),f&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 border-t pt-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium",children:"Status"}),e.jsxs(A,{value:a.status||"all",onValueChange:s=>i(t=>({...t,status:s==="all"?"":s})),children:[e.jsx(E,{children:e.jsx(L,{placeholder:"All Status"})}),e.jsxs(T,{children:[e.jsx(x,{value:"all",children:"All Status"}),e.jsx(x,{value:"ACTIVE",children:"Active"}),e.jsx(x,{value:"CANCELED",children:"Canceled"}),e.jsx(x,{value:"SUSPEND",children:"Suspended"}),e.jsx(x,{value:"DISMANTLE",children:"Dismantled"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium",children:"Group"}),e.jsxs(A,{value:a.group||"all",onValueChange:s=>i(t=>({...t,group:s==="all"?"":s})),children:[e.jsx(E,{children:e.jsx(L,{placeholder:"All Groups"})}),e.jsxs(T,{children:[e.jsx(x,{value:"all",children:"All Groups"}),I.map(s=>e.jsx(x,{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium",children:"Date From"}),e.jsx(v,{type:"date",value:a.date_from,onChange:s=>i(t=>({...t,date_from:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium",children:"Date To"}),e.jsx(v,{type:"date",value:a.date_to,onChange:s=>i(t=>({...t,date_to:s.target.value}))})]})]})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Show"}),e.jsxs("select",{value:p,onChange:s=>{const t=Number(s.target.value);$(t)},className:"rounded border px-2 py-1 text-sm dark:bg-muted dark:text-muted-foreground",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:15,children:"15"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]}),e.jsx("span",{className:"text-sm",children:"entries"})]}),e.jsx("div",{className:"space-y-4",children:r?r.data.length===0?e.jsx("div",{className:"py-8 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No subscriptions found matching your criteria."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"rounded-md",children:e.jsxs("table",{className:"w-full min-w-[1200px] border-collapse",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsx("tr",{children:y.map((s,t)=>e.jsx("th",{className:D(`border-b px-4 py-3 text-left text-sm font-medium ${s.className||""}`,s.sortable&&"cursor-pointer hover:bg-muted/80"),onClick:()=>s.sortable&&M(s.header.toLowerCase().replace(/\s+/g,"_")),children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.header,s.sortable&&e.jsx(U,{field:s.header.toLowerCase().replace(/\s+/g,"_")})]})},t))})}),e.jsx("tbody",{children:r.data.map((s,t)=>e.jsx("tr",{className:"border-b hover:bg-muted/50",children:y.map((l,h)=>e.jsx("td",{className:`px-4 py-3 text-sm ${l.className||""}`,children:l.render(s)},h))},s.subscription_id))})]})})}),r.last_page>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",r.from," to ",r.to," of ",r.total," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>b(d-1),disabled:d<=1||u,children:[e.jsx(ee,{className:"h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,r.last_page)},(s,t)=>{let l;return r.last_page<=5||d<=3?l=t+1:d>=r.last_page-2?l=r.last_page-4+t:l=d-2+t,e.jsx(m,{variant:d===l?"default":"outline",size:"sm",onClick:()=>b(l),disabled:u,className:"h-8 w-8 p-0",children:l},l)})}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>b(d+1),disabled:d>=r.last_page||u,children:["Next",e.jsx(se,{className:"h-4 w-4"})]})]})]})]}):e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(_,{className:"mx-auto mb-4 h-8 w-8 animate-spin"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading data..."})]})})]})]})}export{ve as default};
