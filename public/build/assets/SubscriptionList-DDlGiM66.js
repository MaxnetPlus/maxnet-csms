import{r as i,j as e,t as ne}from"./app-DRGtOjGd.js";import{B as G}from"./badge-DcdIvdgU.js";import{B as o,c as D}from"./createLucideIcon-BJKOySNR.js";import{C as R,a as H,b as oe,d as ce,c as de}from"./card-0Jn99XRP.js";import{D as me,a as ue,b as he,c as xe,d as pe}from"./dialog-uwzJ5mCL.js";import{I as F}from"./input-CLisKsBH.js";import{L as k}from"./label-d2FKzadL.js";import{S as b,a as w,b as y,c as S,d as n}from"./select-CVQw62g2.js";import{T as J}from"./textarea-C6XxC2Ym.js";import{F as je}from"./filter-CN60vnYo.js";import{S as fe}from"./search-Bqv1GQ4X.js";import{L as A}from"./loader-circle-BCF1Mi6y.js";import{X as ge}from"./index-CB33my_v.js";import{C as Ne}from"./chevron-left-BGYx0tT0.js";import{C as ve}from"./chevron-right-CLosCU38.js";import{P as be}from"./plus-DT7RlOZz.js";import{E as we}from"./eye-D_Yky9S5.js";import"./index-DWzctsh-.js";import"./index-B_39LHJZ.js";import"./index-BWNZJE0V.js";import"./index-ofySZ4cZ.js";import"./index-C2fuojxb.js";import"./index-BEm-PsG3.js";import"./index-BEo7z8Fu.js";import"./chevron-down-uz5hctFg.js";const ye={ACTIVE:{label:"Active",className:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"},CANCELED:{label:"Canceled",className:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"},SUSPEND:{label:"Suspended",className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"},DISMANTLE:{label:"Dismantled",className:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}};function $e({initialFilters:u={},groups:K}){var O;const[r,X]=i.useState(null),[p,T]=i.useState(!1),[l,h]=i.useState({search:u.search||"",status:u.status||"all",group:u.group||"all",date_from:u.date_from||"",date_to:u.date_to||"",sort:u.sort||"created_at",direction:u.direction||"desc"}),[d,E]=i.useState(1),[N,$]=i.useState(15),[C,Q]=i.useState(!1),[L,W]=i.useState(""),[Y,v]=i.useState(!1),[x,I]=i.useState(null),[m,f]=i.useState({priority:"medium",description:"",notes:""}),[P,U]=i.useState(!1),Z=(s,t)=>{let a;return(...c)=>{clearTimeout(a),a=setTimeout(()=>s(...c),t)}},g=i.useCallback(async(s=1,t=l,a=!1)=>{var V;const c={page:s,per_page:N,...t},j=JSON.stringify(c);if(!(!a&&j===L)){T(!0),W(j);try{const B=await(await fetch("/admin/subscriptions/table-data",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((V=document.querySelector('meta[name="csrf-token"]'))==null?void 0:V.getAttribute("content"))||""},body:JSON.stringify(c)})).json();X(B),E(B.current_page)}catch(q){console.error("Failed to fetch data:",q)}finally{T(!1)}}},[N,L,d]),ee=i.useCallback(Z((s,t)=>{g(s,t,!0)},300),[]);i.useEffect(()=>{g(1,l,!0)},[]),i.useEffect(()=>{r&&g(1,l,!0)},[N]),i.useEffect(()=>{r&&ee(1,l)},[l]);const se=s=>{s.preventDefault()},_=s=>{s>=1&&s<=((r==null?void 0:r.last_page)||1)&&g(s,l,!0)},te=s=>{const t=l.sort===s&&l.direction==="asc"?"desc":"asc";h(a=>({...a,sort:s,direction:t}))},ae=()=>{h({search:"",status:"all",group:"all",date_from:"",date_to:"",sort:"created_at",direction:"desc"}),E(1)},re=s=>{I(s),f({priority:"medium",description:"",notes:""}),v(!0)},le=async s=>{var t;if(s.preventDefault(),!(!x||!m.description)){U(!0);try{(await fetch(route("admin.subscriptions.create-follow-up",x.subscription_id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},body:JSON.stringify({customer_id:x.customer_id,subscription_id:x.subscription_id,priority:m.priority,description:m.description,assigned_to:"unassigned",notes:m.notes||null})})).ok?(v(!1),I(null),f({priority:"medium",description:"",notes:""}),g(d,l,!0)):console.error("Failed to create follow up")}catch(a){console.error("Error creating follow up:",a)}finally{U(!1)}}},M=s=>new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric"}),ie=({field:s})=>l.sort!==s?e.jsx("span",{className:"text-gray-400",children:"↕"}):l.direction==="asc"?e.jsx("span",{children:"↑"}):e.jsx("span",{children:"↓"}),z=[{header:"Subscription ID",className:"min-w-[140px]",sortable:!0,render:s=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.subscription_id}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.serv_id})]})},{header:"Customer",className:"min-w-[180px]",sortable:!0,render:s=>{var t,a;return e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:(t=s.customer)==null?void 0:t.customer_name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:(a=s.customer)==null?void 0:a.customer_email}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: ",s.customer_id]})]})}},{header:"Address",className:"min-w-[200px]",render:s=>e.jsx("div",{className:"max-w-[200px] truncate",title:s.subscription_address,children:s.subscription_address})},{header:"Status",className:"min-w-[100px]",sortable:!0,render:s=>{const t=ye[s.subscription_status];return e.jsx(G,{className:(t==null?void 0:t.className)||"bg-gray-100 text-gray-800",children:(t==null?void 0:t.label)||s.subscription_status})}},{header:"Group",className:"min-w-[80px]",sortable:!0,render:s=>e.jsx("span",{className:"font-mono text-sm",children:s.group})},{header:"Description",className:"min-w-[200px]",render:s=>e.jsx("div",{className:"max-w-[200px] truncate",title:s.subscription_description,children:s.subscription_description})},{header:"Follow Up",className:"min-w-[120px]",render:s=>{var t,a,c;return e.jsx("div",{className:"space-y-1",children:s.has_active_follow_ups?e.jsxs("div",{className:"space-y-1",children:[(t=s.active_follow_ups)==null?void 0:t.slice(0,2).map(j=>e.jsxs("div",{className:"text-xs",children:[e.jsx(G,{variant:"outline",className:"text-xs",children:j.priority}),e.jsxs("span",{className:"ml-1 text-muted-foreground",children:["(",j.status,")"]})]},j.id)),(((a=s.active_follow_ups)==null?void 0:a.length)||0)>2&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["+",(((c=s.active_follow_ups)==null?void 0:c.length)||0)-2," more"]})]}):e.jsxs(o,{size:"sm",variant:"default",onClick:()=>re(s),className:"text-xs",children:[e.jsx(be,{className:"mr-1 h-3 w-3"}),"Add Follow Up"]})})}},{header:"Start Date",className:"min-w-[120px]",sortable:!0,render:s=>e.jsx("div",{className:"text-sm",children:M(s.subscription_start_date)})},{header:"Updated At",className:"min-w-[120px]",sortable:!0,render:s=>e.jsx("div",{className:"text-sm",children:M(s.updated_at)})},{header:"Actions",className:"min-w-[100px]",render:s=>e.jsx("div",{className:"flex gap-2",children:e.jsx(ne,{href:`/admin/subscriptions/${s.subscription_id}`,children:e.jsx(o,{size:"sm",variant:"outline",children:e.jsx(we,{className:"h-4 w-4"})})})})}];return e.jsxs("div",{className:"space-y-4",children:[e.jsx(R,{children:e.jsxs(H,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(oe,{children:"Subscription Management"}),e.jsx(ce,{children:"Manage and track subscription data"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>Q(!C),className:D("gap-2",C&&"bg-muted"),children:[e.jsx(je,{className:"h-4 w-4"}),"Filters"]})})]}),e.jsxs("form",{onSubmit:se,className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(fe,{className:"absolute top-1/2 left-3 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(F,{placeholder:"Search by subscription ID, customer name, email, or address...",value:l.search,onChange:s=>h(t=>({...t,search:s.target.value})),className:"pl-9"})]}),e.jsx(o,{type:"submit",size:"sm",disabled:p,children:p?e.jsx(A,{className:"h-4 w-4 animate-spin"}):"Search"}),(l.search||l.status!=="all"||l.group!=="all"||l.date_from||l.date_to)&&e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:ae,children:[e.jsx(ge,{className:"h-4 w-4"}),"Clear"]})]}),C&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 pt-4 md:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Status"}),e.jsxs(b,{value:l.status,onValueChange:s=>h(t=>({...t,status:s})),children:[e.jsx(w,{children:e.jsx(y,{placeholder:"All Status"})}),e.jsxs(S,{children:[e.jsx(n,{value:"all",children:"All Status"}),e.jsx(n,{value:"ACTIVE",children:"Active"}),e.jsx(n,{value:"CANCELED",children:"Canceled"}),e.jsx(n,{value:"SUSPEND",children:"Suspended"}),e.jsx(n,{value:"DISMANTLE",children:"Dismantled"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Group"}),e.jsxs(b,{value:l.group,onValueChange:s=>h(t=>({...t,group:s})),children:[e.jsx(w,{children:e.jsx(y,{placeholder:"All Groups"})}),e.jsxs(S,{children:[e.jsx(n,{value:"all",children:"All Groups"}),K.map(s=>e.jsx(n,{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Start Date From"}),e.jsx(F,{type:"date",value:l.date_from,onChange:s=>h(t=>({...t,date_from:s.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Start Date To"}),e.jsx(F,{type:"date",value:l.date_to,onChange:s=>h(t=>({...t,date_to:s.target.value}))})]})]})]})}),e.jsxs(R,{children:[e.jsx(H,{className:"pb-3",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",(r==null?void 0:r.from)||0," to ",(r==null?void 0:r.to)||0," of ",(r==null?void 0:r.total)||0," entries"]}),e.jsxs(b,{value:N.toString(),onValueChange:s=>$(parseInt(s)),children:[e.jsx(w,{className:"w-20",children:e.jsx(y,{})}),e.jsxs(S,{children:[e.jsx(n,{value:"15",children:"15"}),e.jsx(n,{value:"25",children:"25"}),e.jsx(n,{value:"50",children:"50"}),e.jsx(n,{value:"100",children:"100"})]})]})]})})}),e.jsx(de,{className:"p-0",children:e.jsxs("div",{className:"relative",children:[p&&e.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-background/50",children:e.jsx(A,{className:"h-8 w-8 animate-spin"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b",children:z.map((s,t)=>e.jsx("th",{className:D("p-3 text-left font-medium",s.className,s.sortable&&"cursor-pointer hover:bg-muted/50"),onClick:()=>s.sortable&&te(s.header.toLowerCase().replace(" ","_")),children:e.jsxs("div",{className:"flex items-center gap-1",children:[s.header,s.sortable&&e.jsx(ie,{field:s.header.toLowerCase().replace(" ","_")})]})},t))})}),e.jsx("tbody",{children:r==null?void 0:r.data.map((s,t)=>e.jsx("tr",{className:"border-b hover:bg-muted/50",children:z.map((a,c)=>e.jsx("td",{className:D("p-3",a.className),children:a.render(s)},c))},t))})]})})]})})]}),r&&r.last_page>1&&e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>_(d-1),disabled:d<=1||p,children:[e.jsx(Ne,{className:"h-4 w-4"}),"Previous"]}),e.jsx("div",{className:"flex gap-1",children:[...Array(Math.min(5,r.last_page))].map((s,t)=>{const a=Math.max(1,Math.min(r.last_page-4,Math.max(1,d-2)))+t;return a<=r.last_page?e.jsx(o,{variant:d===a?"default":"outline",size:"sm",onClick:()=>_(a),disabled:p,className:"min-w-[40px]",children:a},a):null})}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>_(d+1),disabled:d>=r.last_page||p,children:["Next",e.jsx(ve,{className:"h-4 w-4"})]})]}),e.jsx(me,{open:Y,onOpenChange:v,children:e.jsxs(ue,{className:"max-w-md",children:[e.jsxs(he,{children:[e.jsx(xe,{children:"Add Follow Up"}),e.jsxs(pe,{children:["Create a follow up for ",(O=x==null?void 0:x.customer)==null?void 0:O.customer_name]})]}),e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"priority",children:"Priority"}),e.jsxs(b,{value:m.priority,onValueChange:s=>f(t=>({...t,priority:s})),children:[e.jsx(w,{children:e.jsx(y,{placeholder:"Select priority"})}),e.jsxs(S,{children:[e.jsx(n,{value:"low",children:"Low"}),e.jsx(n,{value:"medium",children:"Medium"}),e.jsx(n,{value:"high",children:"High"}),e.jsx(n,{value:"urgent",children:"Urgent"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"description",children:"Description *"}),e.jsx(J,{id:"description",value:m.description,onChange:s=>f(t=>({...t,description:s.target.value})),placeholder:"Describe the follow up requirement...",rows:3,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"notes",children:"Notes"}),e.jsx(J,{id:"notes",value:m.notes,onChange:s=>f(t=>({...t,notes:s.target.value})),placeholder:"Any additional notes...",rows:2})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsxs(o,{type:"submit",disabled:P||!m.description,children:[P?e.jsx(A,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Create Follow Up"]})]})]})]})})]})}export{$e as default};
